# AlgVex æ‰§è¡Œæ–¹æ¡ˆ

> **ç‰ˆæœ¬**: 2.0
> **æ—¥æœŸ**: 2025-12-31
> **ç›®æ ‡**: åŸºäº Qlib v0.9.7 + Hummingbot v2.11.0 æ„å»ºåŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿ

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

æ„å»ºä¸€ä¸ªå®Œæ•´çš„åŠ å¯†è´§å¸é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œé›†æˆï¼š
- **Qlib**: å› å­æŒ–æ˜ã€æ¨¡å‹è®­ç»ƒã€å›æµ‹æ¡†æ¶
- **Hummingbot**: äº¤æ˜“æ‰§è¡Œã€è¿æ¥å™¨ã€é£æ§

### 1.2 æ ¸å¿ƒåŸåˆ™

1. **é€‚é…å±‚æ¨¡å¼**: ç»§æ‰¿/æ‰©å±•åŸæœ‰ä»£ç ï¼Œä¸å¤åˆ¶ä¿®æ”¹
2. **100% åŠŸèƒ½è¦†ç›–**: å®Œæ•´å®ç° Qlib å’Œ Hummingbot æ‰€æœ‰åŠŸèƒ½
3. **åŠ å¯†è´§å¸é€‚é…**: 24/7 äº¤æ˜“ã€æ°¸ç»­åˆçº¦ã€èµ„é‡‘è´¹ç‡

### 1.3 æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Python | 3.10 | å…¼å®¹ Qlib å’Œ Hummingbot |
| Qlib | 0.9.7 | git submodule |
| Hummingbot | 2.11.0 | git submodule |
| æ“ä½œç³»ç»Ÿ | Ubuntu 22.04 | æœåŠ¡å™¨éƒ¨ç½² |

---

## äºŒã€ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AlgVex Platform                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      ç”¨æˆ·æ¥å£å±‚                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚   CLI    â”‚  â”‚Dashboard â”‚  â”‚   API    â”‚  â”‚  Config  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      é€‚é…å±‚ (algvex/)                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚   æ•°æ®   â”‚  â”‚   å› å­   â”‚  â”‚   å›æµ‹   â”‚  â”‚   æ‰§è¡Œ   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ é€‚é…å™¨  â”‚  â”‚  é€‚é…å™¨  â”‚  â”‚  é€‚é…å™¨  â”‚  â”‚  é€‚é…å™¨  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚ ä¿¡å·æ¡¥  â”‚  â”‚ é£æ§ç®¡ç† â”‚  â”‚ å·¥ä½œæµ  â”‚                  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â”‚
â”‚  â”‚  â”‚    Qlib v0.9.7      â”‚       â”‚  Hummingbot v2.11.0 â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ 32 ä¸ªæ¨¡å‹     â”‚  â”‚       â”‚  â”‚ 37 ä¸ªè¿æ¥å™¨   â”‚  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ 52 ä¸ªæ“ä½œç¬¦   â”‚  â”‚       â”‚  â”‚ 7 ä¸ªæ‰§è¡Œå™¨    â”‚  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ 158 ä¸ªå› å­    â”‚  â”‚       â”‚  â”‚ 9 ä¸ªV1ç­–ç•¥    â”‚  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ å›æµ‹æ¡†æ¶      â”‚  â”‚       â”‚  â”‚ é£æ§ç³»ç»Ÿ      â”‚  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ åœ¨çº¿æœåŠ¡      â”‚  â”‚       â”‚  â”‚ MQTT/API      â”‚  â”‚        â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚
â”‚  â”‚           libs/qlib                   libs/hummingbot          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€åŠŸèƒ½æ¸…å•

> **é€‚é…ç­–ç•¥å›¾ä¾‹**: ğŸŸ¢ æ— éœ€ä¿®æ”¹ | ğŸŸ¡ éœ€éªŒè¯/å¾®è°ƒ | ğŸ”´ éœ€å®ç°é€‚é…å±‚

### 3.1 Qlib åŠŸèƒ½æ¸…å• (libs/qlib v0.9.7)

#### 3.1.1 æ¨¡å‹ (32ä¸ª) - å…¨éƒ¨ ğŸŸ¢ æ— éœ€ä¿®æ”¹

| ç±»åˆ« | æ•°é‡ | æ¨¡å‹ | æºç è·¯å¾„ |
|------|------|------|----------|
| ä¼ ç»ŸML | 5 | LinearModel, LGBModel, HFLGBModel, XGBModel, CatBoostModel | `qlib/contrib/model/{linear,gbdt,highfreq_gdbt_model,xgboost,catboost_model}.py` |
| RNN | 12 | LSTM, LSTM_ts, GRU, GRU_ts, ALSTM, ALSTM_ts, GATs, GATs_ts, KRNN, SFM, ADARNN, Sandwich | `qlib/contrib/model/pytorch_*.py` |
| Transformer | 4 | TransformerModel, TransformerModel_ts, LocalformerModel, LocalformerModel_ts | `qlib/contrib/model/pytorch_{transformer,localformer}*.py` |
| CNN | 3 | TCN, TCN_ts, TCTS | `qlib/contrib/model/pytorch_tc*.py` |
| é«˜çº§ | 8 | DNNModelPytorch, GeneralPTNN, TabnetModel, TRAModel, DEnsembleModel, IGMTF, HIST, ADD | `qlib/contrib/model/pytorch_{nn,general_nn,tabnet,tra,igmtf,hist,add}.py`, `double_ensemble.py` |

> **æ³¨**: æ‰€æœ‰æ¨¡å‹æ¥å—æ ‡å‡†åŒ–è¾“å…¥ï¼Œæ— éœ€ä¿®æ”¹ã€‚ä»…éœ€ç¡®ä¿æ•°æ®å±‚æä¾›æ­£ç¡®æ ¼å¼ã€‚

#### 3.1.2 æ“ä½œç¬¦ (52ä¸ª)

| ç±»åˆ« | æ“ä½œç¬¦ | é€‚é… |
|------|--------|------|
| ç»Ÿè®¡ (14) | Sum, Mean, Std, Var, Skew, Kurt, Med, Mad, Slope, Rsquare, Resi, Rank, Quantile, Count | ğŸŸ¢ |
| æå€¼ (4) | Max, Min, IdxMax, IdxMin | ğŸŸ¢ |
| æŠ€æœ¯ (6) | EMA, WMA, Corr, Cov, Delta, Ref | ğŸŸ¢ |
| æ•°å­¦ (8) | Abs, Sign, Log, Power, Add, Sub, Mul, Div | ğŸŸ¢ |
| é€»è¾‘ (13) | Greater, Less, Gt, Ge, Lt, Le, Eq, Ne, And, Or, Not, If, Mask | ğŸŸ¢ |
| é«˜é¢‘ (4) | DayCumsum, DayLast, get_calendar_day, get_calendar_minute | ğŸ”´ éœ€é€‚é… 24/7 æ—¥å† |
| å…¶ä»– (3) | ChangeInstrument, TResample, NpElemOperator | ğŸŸ¢ |

> **æºç **: `qlib/data/ops.py`, `qlib/contrib/ops/high_freq.py`

#### 3.1.3 æ•°æ®åŸºç¡€è®¾æ–½

| ç»„ä»¶ | è¯´æ˜ | é€‚é… | æºç è·¯å¾„ |
|------|------|------|----------|
| CalendarProvider | æ—¥å†æä¾›è€…åŸºç±» | ğŸ”´ éœ€å®ç° CryptoCalendarProvider | `qlib/data/data.py` |
| InstrumentProvider | æ ‡çš„æä¾›è€…åŸºç±» | ğŸ”´ éœ€å®ç° CryptoInstrumentProvider | `qlib/data/data.py` |
| Alpha158/Alpha360 | å› å­å¤„ç†å™¨ | ğŸŸ¡ éœ€é€‚é…çª—å£å‚æ•° | `qlib/contrib/data/handler.py` |
| æ•°æ®å¤„ç†å™¨ (10+) | DropnaProcessor, ZscoreNorm, CSRankNorm ç­‰ | ğŸŸ¢ | `qlib/contrib/data/processor.py` |

#### 3.1.4 å›æµ‹ä¸æ‰§è¡Œ

| ç»„ä»¶ | è¯´æ˜ | é€‚é… | æºç è·¯å¾„ |
|------|------|------|----------|
| Exchange | äº¤æ˜“æ‰€æ¨¡æ‹ŸåŸºç±» | ğŸ”´ éœ€å®ç° CryptoExchange | `qlib/backtest/exchange.py` |
| SimulatorExecutor | åŸºç¡€æ¨¡æ‹Ÿæ‰§è¡Œå™¨ | ğŸŸ¡ éœ€é€‚é…æ°¸ç»­åˆçº¦è§„åˆ™ | `qlib/backtest/executor.py` |
| NestedExecutor | åµŒå¥—å¤šæ—¶é—´å°ºåº¦æ‰§è¡Œ | ğŸŸ¡ éœ€é€‚é… | `qlib/backtest/executor.py` |
| Position | æŒä»“ç®¡ç† | ğŸ”´ éœ€å®ç° PerpetualPosition | `qlib/backtest/position.py` |

#### 3.1.5 å·¥ä½œæµä¸åœ¨çº¿æœåŠ¡

| ç»„ä»¶ | è¯´æ˜ | é€‚é… | æºç è·¯å¾„ |
|------|------|------|----------|
| TaskManager | ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç† | ğŸŸ¢ | `qlib/workflow/task/manage.py` |
| Trainer/TrainerR | æ¨¡å‹è®­ç»ƒå™¨ | ğŸŸ¢ | `qlib/model/trainer.py` |
| OnlineManager | åœ¨çº¿æ¨¡å‹ç®¡ç† | ğŸŸ¢ | `qlib/workflow/online/manager.py` |
| RollingGen | æ»šåŠ¨ä»»åŠ¡ç”Ÿæˆ | ğŸŸ¢ | `qlib/workflow/task/gen.py` |
| PredUpdater | å¢é‡é¢„æµ‹æ›´æ–° | ğŸŸ¢ | `qlib/workflow/online/update.py` |

#### 3.1.6 å…¶ä»–æ¨¡å—

| æ¨¡å— | ç»„ä»¶ | é€‚é… |
|------|------|------|
| é£é™©æ¨¡å‹ | POETCovEstimator, ShrinkCovEstimator, StructuredCovEstimator | ğŸŸ¢ |
| é›†æˆå­¦ä¹  | RollingEnsemble, AverageEnsemble, RollingGroup | ğŸŸ¢ |
| è°ƒä¼˜å™¨ | Tuner, TunerPipeline, SearchSpace | ğŸŸ¢ |
| è¯„ä¼° | calc_ic, risk_analysis, backtest | ğŸŸ¢ |
| æŠ¥å‘Š | cumulative_return_graph, risk_analysis_graph ç­‰ | ğŸŸ¢ |
| RL æ¨¡å— | order_execution, Tianshou é›†æˆ | ğŸŸ¢ å¯é€‰ï¼ŒåæœŸæ·»åŠ  |

#### 3.1.7 å·²æœ‰ Crypto æ•°æ®æ”¶é›†å™¨

> **é‡è¦**: Qlib å·²æœ‰åŠ å¯†è´§å¸æ•°æ®æ”¶é›†å™¨ï¼Œå¯ç›´æ¥æ‰©å±•ï¼

| ç»„ä»¶ | è¯´æ˜ | é€‚é… | æºç è·¯å¾„ |
|------|------|------|----------|
| CryptoCollector | CoinGecko API æ—¥çº¿æ•°æ® | ğŸŸ¡ æ‰©å±•æ”¯æŒ Binance + 1h | `scripts/data_collector/crypto/collector.py` |

### 3.2 Hummingbot åŠŸèƒ½æ¸…å• (libs/hummingbot v2.11.0)

#### 3.2.1 è¿æ¥å™¨ (37ä¸ª) - å…¨éƒ¨ ğŸŸ¢ æ— éœ€ä¿®æ”¹

**æ°¸ç»­åˆçº¦ (11)**:
| è¿æ¥å™¨ | ä¼˜å…ˆçº§ | æºç è·¯å¾„ |
|--------|--------|----------|
| binance_perpetual | âœ… é¦–é€‰ | `connector/derivative/binance_perpetual/` |
| bybit_perpetual | é«˜ | `connector/derivative/bybit_perpetual/` |
| okx_perpetual | é«˜ | `connector/derivative/okx_perpetual/` |
| gate_io_perpetual | ä¸­ | `connector/derivative/gate_io_perpetual/` |
| kucoin_perpetual | ä¸­ | `connector/derivative/kucoin_perpetual/` |
| bitget_perpetual | ä¸­ | `connector/derivative/bitget_perpetual/` |
| bitmart_perpetual | ä½ | `connector/derivative/bitmart_perpetual/` |
| derive_perpetual | ä½ | `connector/derivative/derive_perpetual/` |
| dydx_v4_perpetual | ä½ | `connector/derivative/dydx_v4_perpetual/` |
| hyperliquid_perpetual | ä½ | `connector/derivative/hyperliquid_perpetual/` |
| injective_v2_perpetual | ä½ | `connector/derivative/injective_v2_perpetual/` |

**ç°è´§ (26)**: binance, bybit, okx, kucoin, gate_io, htx, mexc, bitget, kraken, coinbase_advanced_trade, bitstamp, bitmart, bitrue, bing_x, ascend_ex, btc_markets, cube, derive, dexalot, foxbit, hyperliquid, injective_v2, ndax, vertex, xrpl, paper_trade

> **æºç **: `connector/exchange/{name}/`

#### 3.2.2 æ‰§è¡Œå™¨ (7ä¸ª) - å…¨éƒ¨ ğŸŸ¢ æ— éœ€ä¿®æ”¹

| æ‰§è¡Œå™¨ | è¯´æ˜ | æºç è·¯å¾„ |
|--------|------|----------|
| OrderExecutor | å•è®¢å•æ‰§è¡Œ | `strategy_v2/executors/order_executor/` |
| PositionExecutor | ä»“ä½æ‰§è¡Œ (Triple Barrier) | `strategy_v2/executors/position_executor/` |
| DCAExecutor | å®šæŠ•æ‰§è¡Œ | `strategy_v2/executors/dca_executor/` |
| TWAPExecutor | æ—¶é—´åŠ æƒå‡ä»· | `strategy_v2/executors/twap_executor/` |
| GridExecutor | ç½‘æ ¼æ‰§è¡Œ | `strategy_v2/executors/grid_executor/` |
| ArbitrageExecutor | ä¸¤è…¿å¥—åˆ© | `strategy_v2/executors/arbitrage_executor/` |
| XEMMExecutor | è·¨äº¤æ˜“æ‰€åšå¸‚ | `strategy_v2/executors/xemm_executor/` |

#### 3.2.3 V1 ç­–ç•¥ (9ä¸ª) - å…¨éƒ¨ ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨

| ç­–ç•¥ | è¯´æ˜ | æºç è·¯å¾„ |
|------|------|----------|
| pure_market_making | åŸºç¡€åšå¸‚ | `strategy/pure_market_making/` |
| avellaneda_market_making | Avellaneda-Stoikov åšå¸‚ | `strategy/avellaneda_market_making/` |
| cross_exchange_market_making | è·¨äº¤æ˜“æ‰€åšå¸‚ | `strategy/cross_exchange_market_making/` |
| cross_exchange_mining | æµåŠ¨æ€§æŒ–çŸ¿åšå¸‚ | `strategy/cross_exchange_mining/` |
| perpetual_market_making | æ°¸ç»­åˆçº¦åšå¸‚ | `strategy/perpetual_market_making/` |
| amm_arb | AMM-CEX å¥—åˆ© | `strategy/amm_arb/` |
| spot_perpetual_arbitrage | ç°è´§-æ°¸ç»­å¥—åˆ© | `strategy/spot_perpetual_arbitrage/` |
| liquidity_mining | æµåŠ¨æ€§æŒ–çŸ¿ | `strategy/liquidity_mining/` |
| hedge | é£é™©å¯¹å†² | `strategy/hedge/` |

#### 3.2.4 V2 æ§åˆ¶å™¨ - å…¨éƒ¨ ğŸŸ¢ æ— éœ€ä¿®æ”¹

| æ§åˆ¶å™¨ | è¯´æ˜ | æºç è·¯å¾„ |
|--------|------|----------|
| DirectionalTradingControllerBase | æ–¹å‘æ€§äº¤æ˜“åŸºç±» | `strategy_v2/controllers/` |
| MarketMakingControllerBase | åšå¸‚åŸºç±» |
| ControllerBase | æ§åˆ¶å™¨åŸºç±» |

#### 3.2.5 æ•°æ®æº (21+ Kçº¿æº) - å…¨éƒ¨ ğŸŸ¢ æ— éœ€ä¿®æ”¹

> **æºç **: `data_feed/candles_feed/{exchange}_candles/`

binance_perpetual_candles, binance_spot_candles, bybit_perpetual_candles, okx_perpetual_candles, gate_io_perpetual_candles, kucoin_perpetual_candles, hyperliquid_perpetual_candles, mexc_perpetual_candles, bitget_perpetual_candles ç­‰

#### 3.2.6 é£æ§åŠŸèƒ½ - å…¨éƒ¨ ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨

| åŠŸèƒ½ | è¯´æ˜ | æºç è·¯å¾„ |
|------|------|----------|
| Triple Barrier | æ­¢ç›ˆ/æ­¢æŸ/æ—¶é—´é™åˆ¶ | `strategy_v2/executors/position_executor/` |
| Trailing Stop | è¿½è¸ªæ­¢æŸ | `strategy_v2/executors/position_executor/` |
| Kill Switch | ç´§æ€¥åœæ­¢ | `core/kill_switch.py` |
| Balance Limit | èµ„äº§é™é¢ | é…ç½®æ–‡ä»¶ |
| Position Limit | æŒä»“é™åˆ¶ | é…ç½®æ–‡ä»¶ |
| Rate Limiter | API é™é€Ÿ | `connector/*/` |

#### 3.2.7 å…¶ä»–æ¨¡å— - å…¨éƒ¨ ğŸŸ¢ å¯ç›´æ¥ä½¿ç”¨

| æ¨¡å— | è¯´æ˜ | æºç è·¯å¾„ |
|------|------|----------|
| MQTT | æ¶ˆæ¯æ¨é€ | `remote_iface/mqtt.py` |
| Paper Trading | æ¨¡æ‹Ÿäº¤æ˜“ | `connector/exchange/paper_trade/` |
| Backtesting Engine | å›æµ‹å¼•æ“ | `strategy_v2/backtesting/` |
| æ—¥å¿—ç³»ç»Ÿ | Hummingbot å†…ç½® | `logger/` |

### 3.3 é€‚é…å·¥ä½œé‡æ±‡æ€»

| ç±»åˆ« | æ€»æ•° | ğŸŸ¢ æ— éœ€ä¿®æ”¹ | ğŸŸ¡ éœ€éªŒè¯ | ğŸ”´ éœ€å®ç° |
|------|------|-------------|-----------|-----------|
| Qlib æ¨¡å‹ | 32 | 32 | 0 | 0 |
| Qlib æ“ä½œç¬¦ | 52 | 48 | 0 | 4 |
| Qlib åŸºç¡€è®¾æ–½ | 15+ | 10+ | 2 | 3 |
| Hummingbot è¿æ¥å™¨ | 37 | 37 | 0 | 0 |
| Hummingbot æ‰§è¡Œå™¨ | 7 | 7 | 0 | 0 |
| Hummingbot ç­–ç•¥ | 9 | 9 | 0 | 0 |
| **æ€»è®¡** | **152+** | **143+** | **2** | **7** |

> **ç»“è®º**: 95%+ çš„åŠŸèƒ½å¯ç›´æ¥ä½¿ç”¨ï¼Œä»…éœ€å®ç° 7 ä¸ªæ ¸å¿ƒé€‚é…ç±»

---

## å››ã€æ–‡ä»¶ç»“æ„

```
AlgVex/
â”œâ”€â”€ libs/                           # Git Submodules
â”‚   â”œâ”€â”€ qlib/                       # Qlib v0.9.7
â”‚   â””â”€â”€ hummingbot/                 # Hummingbot v2.11.0
â”‚
â”œâ”€â”€ algvex/                         # é€‚é…å±‚ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                     # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ settings.py             # å…¨å±€é…ç½®
â”‚   â”‚   â”œâ”€â”€ qlib_init.py            # Qlib åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ exchange_config.py      # äº¤æ˜“æ‰€é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                       # æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ calendar.py             # CryptoCalendarProvider
â”‚   â”‚   â”œâ”€â”€ instrument.py           # CryptoInstrumentProvider
â”‚   â”‚   â”œâ”€â”€ collector.py            # æ•°æ®æ”¶é›†å™¨ (æ‰©å±• Qlib crypto)
â”‚   â”‚   â”œâ”€â”€ handler.py              # CryptoDataHandler
â”‚   â”‚   â””â”€â”€ converter.py            # Hummingbot Candles -> Qlib æ ¼å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ factors/                    # å› å­å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ alpha158.py             # CryptoAlpha158
â”‚   â”‚   â”œâ”€â”€ alpha360.py             # CryptoAlpha360
â”‚   â”‚   â””â”€â”€ custom.py               # è‡ªå®šä¹‰å› å­
â”‚   â”‚
â”‚   â”œâ”€â”€ backtest/                   # å›æµ‹å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ exchange.py             # CryptoExchange
â”‚   â”‚   â”œâ”€â”€ position.py             # PerpetualPosition
â”‚   â”‚   â”œâ”€â”€ executor.py             # CryptoExecutor
â”‚   â”‚   â””â”€â”€ funding.py              # èµ„é‡‘è´¹ç‡è®¡ç®—
â”‚   â”‚
â”‚   â”œâ”€â”€ bridge/                     # ä¿¡å·æ¡¥
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ converter.py            # ä¿¡å·è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ redis_channel.py        # Redis é€šé“
â”‚   â”‚   â””â”€â”€ mqtt_channel.py         # MQTT é€šé“
â”‚   â”‚
â”‚   â”œâ”€â”€ execution/                  # æ‰§è¡Œå±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ manager.py              # æ‰§è¡Œå™¨ç®¡ç†
â”‚   â”‚   â””â”€â”€ router.py               # è®¢å•è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ risk/                       # é£æ§å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ kill_switch.py          # ç´§æ€¥åœæ­¢
â”‚   â”‚   â”œâ”€â”€ position_limit.py       # ä»“ä½é™åˆ¶
â”‚   â”‚   â””â”€â”€ liquidation.py          # å¼ºå¹³ç›‘æ§
â”‚   â”‚
â”‚   â”œâ”€â”€ workflow/                   # å·¥ä½œæµ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ trainer.py              # è®­ç»ƒç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rolling.py              # æ»šåŠ¨è®­ç»ƒ
â”‚   â”‚   â””â”€â”€ online.py               # åœ¨çº¿æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ dashboard/                  # å¯è§†åŒ– (ä½¿ç”¨ Hummingbot Dashboard æ¨¡å¼)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ app.py                  # Streamlit å…¥å£
â”‚   â”‚
â”‚   â””â”€â”€ cli/                        # å‘½ä»¤è¡Œ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ main.py                 # CLI å…¥å£
â”‚
â”œâ”€â”€ config/                         # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ settings.yaml               # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ exchanges/                  # äº¤æ˜“æ‰€é…ç½®
â”‚   â”‚   â”œâ”€â”€ binance.yaml
â”‚   â”‚   â”œâ”€â”€ bybit.yaml
â”‚   â”‚   â””â”€â”€ okx.yaml
â”‚   â””â”€â”€ strategies/                 # ç­–ç•¥é…ç½®
â”‚       â””â”€â”€ default.yaml
â”‚
â”œâ”€â”€ scripts/                        # è„šæœ¬
â”‚   â”œâ”€â”€ install.sh                  # ä¸€é”®å®‰è£…
â”‚   â”œâ”€â”€ start.sh                    # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ stop.sh                     # åœæ­¢è„šæœ¬
â”‚   â””â”€â”€ download_data.py            # æ•°æ®ä¸‹è½½
â”‚
â”œâ”€â”€ tests/                          # æµ‹è¯•
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”‚
â”œâ”€â”€ docs/                           # æ–‡æ¡£
â”‚   â”œâ”€â”€ TECHNICAL-PROPOSAL.md
â”‚   â””â”€â”€ EXECUTION-PLAN.md
â”‚
â”œâ”€â”€ requirements.txt                # Python ä¾èµ–
â”œâ”€â”€ setup.py                        # å®‰è£…é…ç½®
â””â”€â”€ README.md
```

---

## äº”ã€å¼€å‘è§„èŒƒ

### 5.1 é€‚é…å±‚æ¥å£å®šä¹‰

#### 5.1.1 æ•°æ®å±‚æ¥å£

```python
# algvex/data/calendar.py
from qlib.data.data import CalendarProvider

class CryptoCalendarProvider(CalendarProvider):
    """24/7 åŠ å¯†è´§å¸æ—¥å†"""

    def calendar(self, start_time, end_time, freq="1h") -> List[pd.Timestamp]:
        """
        è¿”å›è¿ç»­æ—¶é—´æˆ³åˆ—è¡¨
        - æ— ä¼‘å¸‚æ—¥
        - æ”¯æŒ: 1min, 5min, 15min, 1h, 4h, 1d
        """
        pass
```

```python
# algvex/data/collector.py
from libs.qlib.scripts.data_collector.crypto.collector import CryptoCollector

class BinancePerpetualCollector(CryptoCollector):
    """å¸å®‰æ°¸ç»­åˆçº¦æ•°æ®æ”¶é›†å™¨"""

    def __init__(self, symbols: List[str], interval: str = "1h"):
        """
        symbols: ["BTC-USDT", "ETH-USDT", ...]
        interval: 1min, 5min, 15min, 1h, 4h, 1d
        """
        pass

    def collect(self, start_date: str, end_date: str) -> pd.DataFrame:
        """æ”¶é›†æ•°æ®å¹¶è¿”å› DataFrame"""
        pass

    def to_qlib_format(self, df: pd.DataFrame) -> None:
        """è½¬æ¢ä¸º Qlib äºŒè¿›åˆ¶æ ¼å¼"""
        pass
```

#### 5.1.2 å›æµ‹å±‚æ¥å£

```python
# algvex/backtest/exchange.py
from qlib.backtest.exchange import Exchange

class CryptoExchange(Exchange):
    """åŠ å¯†è´§å¸äº¤æ˜“æ‰€æ¨¡æ‹Ÿ"""

    def __init__(
        self,
        leverage: int = 10,
        margin_mode: str = "cross",  # cross / isolated
        position_mode: str = "one_way",  # one_way / hedge
        funding_interval: int = 8,  # å°æ—¶
    ):
        pass

    def calculate_funding_fee(self, position, funding_rate: float) -> float:
        """è®¡ç®—èµ„é‡‘è´¹ç”¨"""
        pass

    def calculate_liquidation_price(self, position) -> float:
        """è®¡ç®—å¼ºå¹³ä»·æ ¼"""
        pass
```

#### 5.1.3 ä¿¡å·æ¡¥æ¥å£

```python
# algvex/bridge/converter.py
from dataclasses import dataclass
from typing import List

@dataclass
class TradingSignal:
    symbol: str
    side: str  # BUY / SELL
    amount: float
    price: float = None
    order_type: str = "MARKET"

class SignalConverter:
    """Qlib ä¿¡å· -> Hummingbot è®¢å•"""

    def convert(self, qlib_predictions: pd.DataFrame) -> List[TradingSignal]:
        """
        qlib_predictions: instrument x datetime -> score
        è¿”å›: TradingSignal åˆ—è¡¨
        """
        pass
```

### 5.2 ä»£ç è§„èŒƒ

| è§„èŒƒ | è¦æ±‚ |
|------|------|
| ä»£ç é£æ ¼ | PEP 8 + Black æ ¼å¼åŒ– |
| ç±»å‹æ³¨è§£ | æ‰€æœ‰å…¬å¼€æ¥å£å¿…é¡»æœ‰ç±»å‹æ³¨è§£ |
| æ–‡æ¡£å­—ç¬¦ä¸² | Google é£æ ¼ docstring |
| æµ‹è¯•è¦†ç›–ç‡ | æ ¸å¿ƒæ¨¡å— > 80% |
| æ—¥å¿— | ä½¿ç”¨ Qlib/Hummingbot å†…ç½®æ—¥å¿— |

### 5.3 è¯¦ç»†å®ç°è§„èŒƒ

æœ¬èŠ‚æä¾›æ¯ä¸ªæ¨¡å—çš„å®Œæ•´å®ç°è§„èŒƒï¼ŒåŒ…å«ç±»ç»§æ‰¿å…³ç³»ã€æ–¹æ³•ç­¾åã€æ•°æ®æµå’Œä¾èµ–å…³ç³»ã€‚

#### 5.3.1 æ•°æ®å±‚å®Œæ•´å®ç° (algvex/data/)

**æ–‡ä»¶æ¸…å•ä¸ä¾èµ–å…³ç³»**:

```
algvex/data/
â”œâ”€â”€ __init__.py          # å¯¼å‡ºæ‰€æœ‰å…¬å¼€ç±»
â”œâ”€â”€ calendar.py          # CryptoCalendarProvider (ä¾èµ–: qlib.data.data.CalendarProvider)
â”œâ”€â”€ instrument.py        # CryptoInstrumentProvider (ä¾èµ–: qlib.data.data.InstrumentProvider)
â”œâ”€â”€ collector.py         # BinancePerpetualCollector (ä¾èµ–: libs.qlib.scripts.data_collector.crypto)
â”œâ”€â”€ handler.py           # CryptoDataHandler (ä¾èµ–: qlib.contrib.data.handler.Alpha158)
â””â”€â”€ converter.py         # HummingbotDataConverter (ä¾èµ–: hummingbot.data_feed.candles_feed)
```

**calendar.py å®Œæ•´å®ç°**:

```python
"""
åŠ å¯†è´§å¸ 24/7 æ—¥å†æä¾›è€…

ç»§æ‰¿å…³ç³»: CryptoCalendarProvider -> CalendarProvider
å¼•ç”¨è·¯å¾„: libs/qlib/qlib/data/data.py::CalendarProvider
"""
from typing import List, Union
import pandas as pd
from qlib.data.data import CalendarProvider

class CryptoCalendarProvider(CalendarProvider):
    """
    24/7 åŠ å¯†è´§å¸äº¤æ˜“æ—¥å†

    ä¸ä¼ ç»Ÿè‚¡ç¥¨å¸‚åœºä¸åŒï¼ŒåŠ å¯†è´§å¸å¸‚åœºå…¨å¹´æ— ä¼‘ï¼Œ
    æœ¬ç±»ç”Ÿæˆè¿ç»­çš„æ—¶é—´æˆ³åºåˆ—ï¼Œæ— éœ€æ’é™¤èŠ‚å‡æ—¥ã€‚

    Attributes:
        SUPPORTED_FREQS: æ”¯æŒçš„æ—¶é—´é¢‘ç‡åˆ—è¡¨
    """

    SUPPORTED_FREQS = {
        "1min": "T",
        "5min": "5T",
        "15min": "15T",
        "30min": "30T",
        "1h": "H",
        "4h": "4H",
        "1d": "D",
    }

    def __init__(self):
        """åˆå§‹åŒ–æ—¥å†æä¾›è€…"""
        super().__init__()

    def calendar(
        self,
        start_time: Union[str, pd.Timestamp],
        end_time: Union[str, pd.Timestamp],
        freq: str = "1h",
        future: bool = False,
    ) -> List[pd.Timestamp]:
        """
        ç”ŸæˆæŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„äº¤æ˜“æ—¶é—´æˆ³åˆ—è¡¨

        Args:
            start_time: å¼€å§‹æ—¶é—´ (æ ¼å¼: "2024-01-01" æˆ– pd.Timestamp)
            end_time: ç»“æŸæ—¶é—´
            freq: æ—¶é—´é¢‘ç‡ ("1min", "5min", "15min", "1h", "4h", "1d")
            future: æ˜¯å¦åŒ…å«æœªæ¥æ—¶é—´ (é€šå¸¸ä¸º False)

        Returns:
            List[pd.Timestamp]: æ—¶é—´æˆ³åˆ—è¡¨

        Raises:
            ValueError: å¦‚æœ freq ä¸åœ¨æ”¯æŒåˆ—è¡¨ä¸­

        Example:
            >>> provider = CryptoCalendarProvider()
            >>> cal = provider.calendar("2024-01-01", "2024-01-02", freq="1h")
            >>> len(cal)
            24
        """
        if freq not in self.SUPPORTED_FREQS:
            raise ValueError(f"ä¸æ”¯æŒçš„é¢‘ç‡: {freq}, æ”¯æŒ: {list(self.SUPPORTED_FREQS.keys())}")

        pd_freq = self.SUPPORTED_FREQS[freq]
        start = pd.Timestamp(start_time)
        end = pd.Timestamp(end_time)

        # ç”Ÿæˆè¿ç»­æ—¶é—´åºåˆ— (24/7 æ— ä¼‘å¸‚)
        timestamps = pd.date_range(start=start, end=end, freq=pd_freq)

        if not future:
            now = pd.Timestamp.now()
            timestamps = timestamps[timestamps <= now]

        return timestamps.tolist()

    def locate_index(
        self,
        start_time: Union[str, pd.Timestamp],
        end_time: Union[str, pd.Timestamp],
        freq: str = "1h",
        future: bool = False,
    ) -> tuple:
        """
        è·å–æ—¶é—´èŒƒå›´åœ¨æ—¥å†ä¸­çš„ç´¢å¼•ä½ç½®

        Args:
            start_time: å¼€å§‹æ—¶é—´
            end_time: ç»“æŸæ—¶é—´
            freq: æ—¶é—´é¢‘ç‡
            future: æ˜¯å¦åŒ…å«æœªæ¥

        Returns:
            tuple: (start_index, end_index)
        """
        cal = self.calendar(start_time, end_time, freq, future)
        return 0, len(cal) - 1
```

**instrument.py å®Œæ•´å®ç°**:

```python
"""
åŠ å¯†è´§å¸å“ç§æä¾›è€…

ç»§æ‰¿å…³ç³»: CryptoInstrumentProvider -> InstrumentProvider
å¼•ç”¨è·¯å¾„: libs/qlib/qlib/data/data.py::InstrumentProvider
"""
from typing import List, Dict, Union
import pandas as pd
from qlib.data.data import InstrumentProvider

class CryptoInstrumentProvider(InstrumentProvider):
    """
    åŠ å¯†è´§å¸äº¤æ˜“å“ç§ç®¡ç†

    ç®¡ç†æ”¯æŒçš„åŠ å¯†è´§å¸äº¤æ˜“å¯¹åˆ—è¡¨ï¼Œæä¾›å“ç§ç­›é€‰å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚

    Attributes:
        DEFAULT_SYMBOLS: é»˜è®¤æ”¯æŒçš„äº¤æ˜“å¯¹åˆ—è¡¨
    """

    DEFAULT_SYMBOLS = [
        "BTC-USDT", "ETH-USDT", "BNB-USDT", "SOL-USDT", "XRP-USDT",
        "ADA-USDT", "DOGE-USDT", "AVAX-USDT", "DOT-USDT", "MATIC-USDT",
        "LINK-USDT", "UNI-USDT", "ATOM-USDT", "LTC-USDT", "ETC-USDT",
        "FIL-USDT", "APT-USDT", "ARB-USDT", "OP-USDT", "INJ-USDT",
    ]

    def __init__(self, symbols: List[str] = None):
        """
        åˆå§‹åŒ–å“ç§æä¾›è€…

        Args:
            symbols: è‡ªå®šä¹‰å“ç§åˆ—è¡¨ï¼ŒNone åˆ™ä½¿ç”¨é»˜è®¤åˆ—è¡¨
        """
        super().__init__()
        self.symbols = symbols or self.DEFAULT_SYMBOLS

    def list_instruments(
        self,
        instruments: Union[str, List[str]] = None,
        start_time: str = None,
        end_time: str = None,
        as_list: bool = False,
    ) -> Union[Dict[str, tuple], List[str]]:
        """
        åˆ—å‡ºå¯ç”¨çš„äº¤æ˜“å“ç§

        Args:
            instruments: å“ç§ç­›é€‰æ¡ä»¶ (æ”¯æŒ "all", "top10", æˆ–å…·ä½“åˆ—è¡¨)
            start_time: å¼€å§‹æ—¶é—´ (åŠ å¯†è´§å¸æ— å†å²é™åˆ¶ï¼Œå¯å¿½ç•¥)
            end_time: ç»“æŸæ—¶é—´
            as_list: æ˜¯å¦è¿”å›åˆ—è¡¨æ ¼å¼

        Returns:
            Union[Dict, List]: å“ç§ä¿¡æ¯å­—å…¸æˆ–åˆ—è¡¨

        Example:
            >>> provider = CryptoInstrumentProvider()
            >>> symbols = provider.list_instruments(instruments="top10", as_list=True)
            >>> len(symbols)
            10
        """
        if instruments == "all" or instruments is None:
            selected = self.symbols
        elif instruments == "top10":
            selected = self.symbols[:10]
        elif instruments == "top20":
            selected = self.symbols[:20]
        elif isinstance(instruments, list):
            selected = [s for s in instruments if s in self.symbols]
        else:
            selected = self.symbols

        if as_list:
            return selected

        # è¿”å› {symbol: (start_time, end_time)} æ ¼å¼
        return {s: (start_time, end_time) for s in selected}
```

**collector.py å®Œæ•´å®ç°**:

```python
"""
å¸å®‰æ°¸ç»­åˆçº¦æ•°æ®æ”¶é›†å™¨

ç»§æ‰¿å…³ç³»: BinancePerpetualCollector -> CryptoCollector
å¼•ç”¨è·¯å¾„: libs/qlib/scripts/data_collector/crypto/collector.py::CryptoCollector
"""
import os
import time
from typing import List, Optional
from datetime import datetime
import pandas as pd
import requests
from pathlib import Path

# å°è¯•å¯¼å…¥ Qlib çš„ CryptoCollectorï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨åŸºç±»
try:
    from libs.qlib.scripts.data_collector.crypto.collector import CryptoCollector
    BASE_CLASS = CryptoCollector
except ImportError:
    BASE_CLASS = object

class BinancePerpetualCollector(BASE_CLASS):
    """
    å¸å®‰æ°¸ç»­åˆçº¦ OHLCV æ•°æ®æ”¶é›†å™¨

    ä»å¸å®‰ API è·å–æ°¸ç»­åˆçº¦çš„ K çº¿æ•°æ®ï¼Œå¹¶è½¬æ¢ä¸º Qlib æ ¼å¼ã€‚

    Attributes:
        BASE_URL: å¸å®‰ API åŸºç¡€ URL
        INTERVALS: æ”¯æŒçš„ K çº¿å‘¨æœŸæ˜ å°„
        RATE_LIMIT: API è¯·æ±‚é—´éš” (ç§’)
    """

    BASE_URL = "https://fapi.binance.com"

    INTERVALS = {
        "1min": "1m",
        "5min": "5m",
        "15min": "15m",
        "30min": "30m",
        "1h": "1h",
        "4h": "4h",
        "1d": "1d",
    }

    RATE_LIMIT = 0.1  # 100ms é—´éš”é¿å…é™é€Ÿ

    def __init__(
        self,
        symbols: List[str],
        interval: str = "1h",
        output_dir: str = "./data/crypto",
    ):
        """
        åˆå§‹åŒ–æ”¶é›†å™¨

        Args:
            symbols: äº¤æ˜“å¯¹åˆ—è¡¨ (æ ¼å¼: ["BTC-USDT", "ETH-USDT"])
            interval: K çº¿å‘¨æœŸ
            output_dir: æ•°æ®è¾“å‡ºç›®å½•

        Raises:
            ValueError: å¦‚æœ interval ä¸æ”¯æŒ
        """
        if interval not in self.INTERVALS:
            raise ValueError(f"ä¸æ”¯æŒçš„å‘¨æœŸ: {interval}")

        self.symbols = symbols
        self.interval = interval
        self.binance_interval = self.INTERVALS[interval]
        self.output_dir = Path(output_dir)
        self.output_dir.mkdir(parents=True, exist_ok=True)

    def _convert_symbol(self, symbol: str) -> str:
        """
        è½¬æ¢å“ç§æ ¼å¼: BTC-USDT -> BTCUSDT
        """
        return symbol.replace("-", "")

    def _fetch_klines(
        self,
        symbol: str,
        start_time: int,
        end_time: int,
        limit: int = 1000,
    ) -> List[list]:
        """
        ä»å¸å®‰ API è·å– K çº¿æ•°æ®

        Args:
            symbol: å¸å®‰æ ¼å¼çš„äº¤æ˜“å¯¹ (å¦‚ BTCUSDT)
            start_time: å¼€å§‹æ—¶é—´æˆ³ (æ¯«ç§’)
            end_time: ç»“æŸæ—¶é—´æˆ³ (æ¯«ç§’)
            limit: æ¯æ¬¡è¯·æ±‚çš„æ•°æ®æ¡æ•° (æœ€å¤§ 1500)

        Returns:
            List[list]: K çº¿æ•°æ®åˆ—è¡¨
        """
        url = f"{self.BASE_URL}/fapi/v1/klines"
        params = {
            "symbol": symbol,
            "interval": self.binance_interval,
            "startTime": start_time,
            "endTime": end_time,
            "limit": limit,
        }

        response = requests.get(url, params=params, timeout=30)
        response.raise_for_status()
        return response.json()

    def collect(
        self,
        start_date: str,
        end_date: str,
        show_progress: bool = True,
    ) -> pd.DataFrame:
        """
        æ”¶é›†æŒ‡å®šæ—¶é—´èŒƒå›´çš„æ•°æ®

        Args:
            start_date: å¼€å§‹æ—¥æœŸ (æ ¼å¼: "2024-01-01")
            end_date: ç»“æŸæ—¥æœŸ
            show_progress: æ˜¯å¦æ˜¾ç¤ºè¿›åº¦

        Returns:
            pd.DataFrame: åŒ…å«æ‰€æœ‰å“ç§æ•°æ®çš„ DataFrame

        Columns:
            - datetime: æ—¶é—´æˆ³
            - instrument: å“ç§ä»£ç 
            - open, high, low, close: OHLC ä»·æ ¼
            - volume: æˆäº¤é‡
            - amount: æˆäº¤é¢
        """
        start_ts = int(pd.Timestamp(start_date).timestamp() * 1000)
        end_ts = int(pd.Timestamp(end_date).timestamp() * 1000)

        all_data = []

        for i, symbol in enumerate(self.symbols):
            if show_progress:
                print(f"æ”¶é›† {symbol} ({i+1}/{len(self.symbols)})...")

            binance_symbol = self._convert_symbol(symbol)
            symbol_data = []
            current_start = start_ts

            while current_start < end_ts:
                try:
                    klines = self._fetch_klines(
                        binance_symbol,
                        current_start,
                        end_ts,
                        limit=1000,
                    )

                    if not klines:
                        break

                    for k in klines:
                        symbol_data.append({
                            "datetime": pd.Timestamp(k[0], unit="ms"),
                            "instrument": symbol,
                            "open": float(k[1]),
                            "high": float(k[2]),
                            "low": float(k[3]),
                            "close": float(k[4]),
                            "volume": float(k[5]),
                            "amount": float(k[7]),  # Quote asset volume
                        })

                    # æ›´æ–°èµ·å§‹æ—¶é—´ä¸ºæœ€åä¸€æ¡æ•°æ®çš„æ—¶é—´ + 1
                    current_start = klines[-1][0] + 1
                    time.sleep(self.RATE_LIMIT)

                except Exception as e:
                    print(f"è·å– {symbol} æ•°æ®å¤±è´¥: {e}")
                    break

            all_data.extend(symbol_data)

        df = pd.DataFrame(all_data)
        if not df.empty:
            df = df.sort_values(["instrument", "datetime"]).reset_index(drop=True)

        return df

    def to_qlib_format(
        self,
        df: pd.DataFrame,
        qlib_dir: str = None,
    ) -> None:
        """
        å°†æ•°æ®è½¬æ¢ä¸º Qlib äºŒè¿›åˆ¶æ ¼å¼

        Args:
            df: æ”¶é›†çš„åŸå§‹æ•°æ® DataFrame
            qlib_dir: Qlib æ•°æ®ç›®å½• (é»˜è®¤: output_dir/qlib_data)

        ç”Ÿæˆæ–‡ä»¶ç»“æ„:
            qlib_dir/
            â”œâ”€â”€ calendars/
            â”‚   â””â”€â”€ crypto.txt
            â”œâ”€â”€ instruments/
            â”‚   â””â”€â”€ all.txt
            â””â”€â”€ features/
                â”œâ”€â”€ BTC-USDT/
                â”‚   â”œâ”€â”€ open.bin
                â”‚   â”œâ”€â”€ high.bin
                â”‚   â””â”€â”€ ...
                â””â”€â”€ ETH-USDT/
                    â””â”€â”€ ...
        """
        if qlib_dir is None:
            qlib_dir = self.output_dir / "qlib_data"

        qlib_dir = Path(qlib_dir)

        # åˆ›å»ºç›®å½•ç»“æ„
        (qlib_dir / "calendars").mkdir(parents=True, exist_ok=True)
        (qlib_dir / "instruments").mkdir(parents=True, exist_ok=True)
        (qlib_dir / "features").mkdir(parents=True, exist_ok=True)

        # ç”Ÿæˆæ—¥å†æ–‡ä»¶
        calendar = df["datetime"].drop_duplicates().sort_values()
        calendar_file = qlib_dir / "calendars" / "crypto.txt"
        with open(calendar_file, "w") as f:
            for dt in calendar:
                f.write(dt.strftime("%Y-%m-%d %H:%M:%S") + "\n")

        # ç”Ÿæˆå“ç§åˆ—è¡¨æ–‡ä»¶
        instruments = df["instrument"].unique()
        instruments_file = qlib_dir / "instruments" / "all.txt"
        with open(instruments_file, "w") as f:
            for inst in instruments:
                start = df[df["instrument"] == inst]["datetime"].min()
                end = df[df["instrument"] == inst]["datetime"].max()
                f.write(f"{inst}\t{start.strftime('%Y-%m-%d')}\t{end.strftime('%Y-%m-%d')}\n")

        # ç”Ÿæˆç‰¹å¾æ–‡ä»¶ (ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…åº”ä½¿ç”¨ Qlib çš„ dump_bin)
        features = ["open", "high", "low", "close", "volume", "amount"]
        for inst in instruments:
            inst_dir = qlib_dir / "features" / inst
            inst_dir.mkdir(parents=True, exist_ok=True)

            inst_data = df[df["instrument"] == inst].set_index("datetime").sort_index()
            for feat in features:
                feat_file = inst_dir / f"{feat}.bin"
                inst_data[feat].values.astype("float32").tofile(feat_file)

        print(f"Qlib æ•°æ®å·²ä¿å­˜åˆ°: {qlib_dir}")
```

**handler.py å®Œæ•´å®ç°**:

```python
"""
åŠ å¯†è´§å¸æ•°æ®å¤„ç†å™¨

ç»§æ‰¿å…³ç³»: CryptoDataHandler -> Alpha158
å¼•ç”¨è·¯å¾„: libs/qlib/qlib/contrib/data/handler.py::Alpha158
"""
from typing import List, Dict, Any
from qlib.contrib.data.handler import Alpha158
from qlib.contrib.data.loader import Alpha158DL

class CryptoAlpha158Config:
    """Alpha158 åŠ å¯†è´§å¸é…ç½®"""

    # çª—å£æ¨¡å¼
    WINDOW_MODE = "compressed"  # "compressed" æˆ– "equivalent"

    # å‹ç¼©çª—å£ (é€‚åˆé«˜é¢‘äº¤æ˜“)
    COMPRESSED_WINDOWS = [24, 48, 120, 168, 336]

    # ç­‰ä»·çª—å£ (ä¿æŒä¸æ—¥çº¿ç›¸åŒçš„å›æº¯å¤©æ•°)
    EQUIVALENT_WINDOWS = [120, 240, 480, 720, 1440]

    @classmethod
    def get_windows(cls) -> List[int]:
        """è·å–å½“å‰é…ç½®çš„çª—å£åˆ—è¡¨"""
        if cls.WINDOW_MODE == "compressed":
            return cls.COMPRESSED_WINDOWS
        return cls.EQUIVALENT_WINDOWS


class CryptoDataHandler(Alpha158):
    """
    åŠ å¯†è´§å¸ Alpha158 æ•°æ®å¤„ç†å™¨

    æ‰©å±• Qlib Alpha158ï¼Œé€‚é…åŠ å¯†è´§å¸å¸‚åœºç‰¹æ€§:
    - 24/7 äº¤æ˜“æ—¥å†
    - å°æ—¶çº§åˆ«æ•°æ®
    - è‡ªå®šä¹‰çª—å£å‚æ•°

    Attributes:
        CUSTOM_FACTORS: åŠ å¯†è´§å¸ç‰¹æœ‰å› å­
    """

    CUSTOM_FACTORS = [
        "funding_rate",      # èµ„é‡‘è´¹ç‡
        "open_interest",     # æŒä»“é‡
        "long_short_ratio",  # å¤šç©ºæ¯”
    ]

    def __init__(
        self,
        instruments: str = "all",
        start_time: str = None,
        end_time: str = None,
        freq: str = "1h",
        window_mode: str = "compressed",
        include_custom_factors: bool = True,
        **kwargs,
    ):
        """
        åˆå§‹åŒ–å¤„ç†å™¨

        Args:
            instruments: å“ç§èŒƒå›´
            start_time: å¼€å§‹æ—¶é—´
            end_time: ç»“æŸæ—¶é—´
            freq: æ•°æ®é¢‘ç‡ (é»˜è®¤ 1h)
            window_mode: çª—å£æ¨¡å¼ ("compressed" æˆ– "equivalent")
            include_custom_factors: æ˜¯å¦åŒ…å«è‡ªå®šä¹‰å› å­
            **kwargs: ä¼ é€’ç»™çˆ¶ç±»çš„å…¶ä»–å‚æ•°
        """
        CryptoAlpha158Config.WINDOW_MODE = window_mode
        self.include_custom_factors = include_custom_factors

        super().__init__(
            instruments=instruments,
            start_time=start_time,
            end_time=end_time,
            freq=freq,
            **kwargs,
        )

    @classmethod
    def get_feature_config(cls) -> Dict[str, Any]:
        """
        è·å–ç‰¹å¾é…ç½®

        é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œä½¿ç”¨åŠ å¯†è´§å¸é€‚é…çš„çª—å£å‚æ•°

        Returns:
            Dict: ç‰¹å¾é…ç½®å­—å…¸
        """
        windows = CryptoAlpha158Config.get_windows()

        config = {
            "price": {
                "windows": [0, 1, 2, 3, 4],
                "feature": ["open", "high", "low", "close"],
            },
            "volume": {
                "windows": [0, 1, 2, 3, 4],
            },
            "rolling": {
                "windows": windows,
            },
        }

        return Alpha158DL.get_feature_config(config)
```

#### 5.3.2 å›æµ‹å±‚å®Œæ•´å®ç° (algvex/backtest/)

**æ–‡ä»¶æ¸…å•ä¸ä¾èµ–å…³ç³»**:

```
algvex/backtest/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ exchange.py          # CryptoExchange (ä¾èµ–: qlib.backtest.exchange.Exchange)
â”œâ”€â”€ position.py          # PerpetualPosition (ä¾èµ–: qlib.backtest.position.Position)
â”œâ”€â”€ executor.py          # CryptoExecutor (ä¾èµ–: qlib.backtest.executor.SimulatorExecutor)
â””â”€â”€ funding.py           # FundingRateCalculator (ç‹¬ç«‹æ¨¡å—)
```

**exchange.py å®Œæ•´å®ç°**:

```python
"""
åŠ å¯†è´§å¸äº¤æ˜“æ‰€æ¨¡æ‹Ÿå™¨

ç»§æ‰¿å…³ç³»: CryptoExchange -> Exchange
å¼•ç”¨è·¯å¾„: libs/qlib/qlib/backtest/exchange.py::Exchange
"""
from typing import Dict, Optional, Tuple
from decimal import Decimal
import pandas as pd
from qlib.backtest.exchange import Exchange

class MarginMode:
    """ä¿è¯é‡‘æ¨¡å¼"""
    CROSS = "cross"      # å…¨ä»“
    ISOLATED = "isolated"  # é€ä»“

class PositionMode:
    """æŒä»“æ¨¡å¼"""
    ONE_WAY = "one_way"  # å•å‘æŒä»“
    HEDGE = "hedge"      # åŒå‘æŒä»“


class CryptoExchange(Exchange):
    """
    åŠ å¯†è´§å¸äº¤æ˜“æ‰€æ¨¡æ‹Ÿ

    æ‰©å±• Qlib Exchangeï¼Œæ”¯æŒ:
    - æ æ†äº¤æ˜“ (1-125x)
    - æ°¸ç»­åˆçº¦
    - èµ„é‡‘è´¹ç‡ç»“ç®—
    - å¼ºå¹³æœºåˆ¶

    Attributes:
        DEFAULT_LEVERAGE: é»˜è®¤æ æ†å€æ•°
        DEFAULT_MARGIN_MODE: é»˜è®¤ä¿è¯é‡‘æ¨¡å¼
        MAKER_FEE: Maker æ‰‹ç»­è´¹ç‡
        TAKER_FEE: Taker æ‰‹ç»­è´¹ç‡
    """

    DEFAULT_LEVERAGE = 10
    DEFAULT_MARGIN_MODE = MarginMode.CROSS
    MAKER_FEE = Decimal("0.0002")  # 0.02%
    TAKER_FEE = Decimal("0.0004")  # 0.04%
    FUNDING_INTERVAL = 8  # å°æ—¶

    def __init__(
        self,
        leverage: int = 10,
        margin_mode: str = MarginMode.CROSS,
        position_mode: str = PositionMode.ONE_WAY,
        funding_interval: int = 8,
        maintenance_margin_rate: float = 0.004,
        **kwargs,
    ):
        """
        åˆå§‹åŒ–äº¤æ˜“æ‰€æ¨¡æ‹Ÿå™¨

        Args:
            leverage: æ æ†å€æ•° (1-125)
            margin_mode: ä¿è¯é‡‘æ¨¡å¼ ("cross" æˆ– "isolated")
            position_mode: æŒä»“æ¨¡å¼ ("one_way" æˆ– "hedge")
            funding_interval: èµ„é‡‘è´¹ç‡ç»“ç®—é—´éš” (å°æ—¶)
            maintenance_margin_rate: ç»´æŒä¿è¯é‡‘ç‡
            **kwargs: ä¼ é€’ç»™çˆ¶ç±»çš„å‚æ•°

        Raises:
            ValueError: æ æ†å€æ•°è¶…å‡ºèŒƒå›´
        """
        if not 1 <= leverage <= 125:
            raise ValueError(f"æ æ†å€æ•°å¿…é¡»åœ¨ 1-125 ä¹‹é—´ï¼Œå½“å‰: {leverage}")

        super().__init__(**kwargs)

        self.leverage = leverage
        self.margin_mode = margin_mode
        self.position_mode = position_mode
        self.funding_interval = funding_interval
        self.maintenance_margin_rate = Decimal(str(maintenance_margin_rate))

        # èµ„é‡‘è´¹ç‡å†å²
        self._funding_rates: Dict[str, pd.DataFrame] = {}

    def set_funding_rates(self, symbol: str, rates: pd.DataFrame) -> None:
        """
        è®¾ç½®å“ç§çš„å†å²èµ„é‡‘è´¹ç‡

        Args:
            symbol: äº¤æ˜“å¯¹
            rates: èµ„é‡‘è´¹ç‡ DataFrame (index: datetime, columns: ["rate"])
        """
        self._funding_rates[symbol] = rates

    def get_funding_rate(self, symbol: str, timestamp: pd.Timestamp) -> Decimal:
        """
        è·å–æŒ‡å®šæ—¶é—´çš„èµ„é‡‘è´¹ç‡

        Args:
            symbol: äº¤æ˜“å¯¹
            timestamp: æ—¶é—´æˆ³

        Returns:
            Decimal: èµ„é‡‘è´¹ç‡ (å¦‚ 0.0001 è¡¨ç¤º 0.01%)
        """
        if symbol not in self._funding_rates:
            return Decimal("0.0001")  # é»˜è®¤è´¹ç‡

        rates = self._funding_rates[symbol]
        if timestamp in rates.index:
            return Decimal(str(rates.loc[timestamp, "rate"]))

        # æ‰¾æœ€è¿‘çš„è´¹ç‡
        idx = rates.index.get_indexer([timestamp], method="ffill")[0]
        if idx >= 0:
            return Decimal(str(rates.iloc[idx]["rate"]))

        return Decimal("0.0001")

    def calculate_funding_fee(
        self,
        symbol: str,
        position_value: Decimal,
        funding_rate: Decimal,
        is_long: bool,
    ) -> Decimal:
        """
        è®¡ç®—èµ„é‡‘è´¹ç”¨

        Args:
            symbol: äº¤æ˜“å¯¹
            position_value: ä»“ä½ä»·å€¼ (æ•°é‡ * ä»·æ ¼)
            funding_rate: èµ„é‡‘è´¹ç‡
            is_long: æ˜¯å¦å¤šå¤´

        Returns:
            Decimal: èµ„é‡‘è´¹ç”¨ (æ­£æ•°ä¸ºæ”¯ä»˜ï¼Œè´Ÿæ•°ä¸ºæ”¶å–)

        å…¬å¼:
            å¤šå¤´: funding_fee = position_value * funding_rate
            ç©ºå¤´: funding_fee = -position_value * funding_rate
        """
        fee = position_value * funding_rate
        return fee if is_long else -fee

    def calculate_liquidation_price(
        self,
        entry_price: Decimal,
        leverage: int,
        is_long: bool,
        margin_mode: str = None,
    ) -> Decimal:
        """
        è®¡ç®—å¼ºå¹³ä»·æ ¼

        Args:
            entry_price: å¼€ä»“ä»·æ ¼
            leverage: æ æ†å€æ•°
            is_long: æ˜¯å¦å¤šå¤´
            margin_mode: ä¿è¯é‡‘æ¨¡å¼ (é»˜è®¤ä½¿ç”¨å®ä¾‹é…ç½®)

        Returns:
            Decimal: å¼ºå¹³ä»·æ ¼

        å…¬å¼ (å…¨ä»“ç®€åŒ–ç‰ˆ):
            å¤šå¤´: liquidation_price = entry_price * (1 - 1/leverage + mmr)
            ç©ºå¤´: liquidation_price = entry_price * (1 + 1/leverage - mmr)
        """
        margin_mode = margin_mode or self.margin_mode
        mmr = self.maintenance_margin_rate

        if is_long:
            liq_price = entry_price * (1 - Decimal(1) / leverage + mmr)
        else:
            liq_price = entry_price * (1 + Decimal(1) / leverage - mmr)

        return liq_price

    def calculate_pnl(
        self,
        entry_price: Decimal,
        exit_price: Decimal,
        quantity: Decimal,
        leverage: int,
        is_long: bool,
    ) -> Dict[str, Decimal]:
        """
        è®¡ç®—ç›ˆäº

        Args:
            entry_price: å¼€ä»“ä»·æ ¼
            exit_price: å¹³ä»“ä»·æ ¼
            quantity: æ•°é‡
            leverage: æ æ†å€æ•°
            is_long: æ˜¯å¦å¤šå¤´

        Returns:
            Dict: åŒ…å« pnl, roe, margin çš„å­—å…¸
        """
        position_value = entry_price * quantity
        margin = position_value / leverage

        if is_long:
            pnl = (exit_price - entry_price) * quantity
        else:
            pnl = (entry_price - exit_price) * quantity

        roe = pnl / margin if margin > 0 else Decimal(0)

        return {
            "pnl": pnl,
            "roe": roe,
            "margin": margin,
            "position_value": position_value,
        }
```

**funding.py å®Œæ•´å®ç°**:

```python
"""
èµ„é‡‘è´¹ç‡è®¡ç®—æ¨¡å—

ç‹¬ç«‹æ¨¡å—ï¼Œä¸ä¾èµ– Qlib
"""
from typing import Optional, Tuple
from decimal import Decimal
from datetime import datetime, timedelta
import pandas as pd


class FundingRateCalculator:
    """
    èµ„é‡‘è´¹ç‡è®¡ç®—å™¨

    å®ç°èµ„é‡‘è´¹ç‡çš„è®¡ç®—å’Œç»“ç®—é€»è¾‘ã€‚

    èµ„é‡‘è´¹ç‡å…¬å¼:
        Funding Rate = Average Premium Index + clamp(Interest Rate - Premium Index, -0.05%, 0.05%)

    å…¶ä¸­:
        Premium Index = (Max(0, Impact Bid Price - Mark Price) - Max(0, Mark Price - Impact Ask Price)) / Mark Price
        Interest Rate = (Quote Interest Rate - Base Interest Rate) / Funding Interval

    Attributes:
        DEFAULT_INTEREST_RATE: é»˜è®¤åˆ©ç‡ (é€šå¸¸ä¸º 0.03% / å¤©)
        CLAMP_RANGE: è´¹ç‡é’³åˆ¶èŒƒå›´
    """

    DEFAULT_INTEREST_RATE = Decimal("0.0001")  # 0.01%
    CLAMP_RANGE = (Decimal("-0.0005"), Decimal("0.0005"))  # -0.05% ~ 0.05%
    FUNDING_INTERVALS = [0, 8, 16]  # UTC æ—¶é—´

    @classmethod
    def calculate_premium_index(
        cls,
        impact_bid: Decimal,
        impact_ask: Decimal,
        mark_price: Decimal,
    ) -> Decimal:
        """
        è®¡ç®—æº¢ä»·æŒ‡æ•°

        Args:
            impact_bid: æ·±åº¦åŠ æƒä¹°ä¸€ä»·
            impact_ask: æ·±åº¦åŠ æƒå–ä¸€ä»·
            mark_price: æ ‡è®°ä»·æ ¼

        Returns:
            Decimal: æº¢ä»·æŒ‡æ•°
        """
        bid_premium = max(Decimal(0), impact_bid - mark_price)
        ask_premium = max(Decimal(0), mark_price - impact_ask)
        return (bid_premium - ask_premium) / mark_price

    @classmethod
    def calculate_funding_rate(
        cls,
        premium_index: Decimal,
        interest_rate: Decimal = None,
    ) -> Decimal:
        """
        è®¡ç®—èµ„é‡‘è´¹ç‡

        Args:
            premium_index: æº¢ä»·æŒ‡æ•°
            interest_rate: åˆ©ç‡å·® (é»˜è®¤ä½¿ç”¨ DEFAULT_INTEREST_RATE)

        Returns:
            Decimal: èµ„é‡‘è´¹ç‡
        """
        interest_rate = interest_rate or cls.DEFAULT_INTEREST_RATE

        # é’³åˆ¶
        diff = interest_rate - premium_index
        clamped = max(cls.CLAMP_RANGE[0], min(cls.CLAMP_RANGE[1], diff))

        return premium_index + clamped

    @classmethod
    def get_next_funding_time(cls, current_time: datetime) -> datetime:
        """
        è·å–ä¸‹ä¸€ä¸ªèµ„é‡‘è´¹ç‡ç»“ç®—æ—¶é—´

        Args:
            current_time: å½“å‰æ—¶é—´ (UTC)

        Returns:
            datetime: ä¸‹ä¸€ä¸ªç»“ç®—æ—¶é—´
        """
        current_hour = current_time.hour

        for funding_hour in cls.FUNDING_INTERVALS:
            if current_hour < funding_hour:
                return current_time.replace(
                    hour=funding_hour, minute=0, second=0, microsecond=0
                )

        # ä¸‹ä¸€å¤©çš„ 00:00
        next_day = current_time + timedelta(days=1)
        return next_day.replace(hour=0, minute=0, second=0, microsecond=0)

    @classmethod
    def is_funding_time(cls, timestamp: datetime) -> bool:
        """
        æ£€æŸ¥æ˜¯å¦ä¸ºèµ„é‡‘è´¹ç‡ç»“ç®—æ—¶é—´

        Args:
            timestamp: æ—¶é—´æˆ³

        Returns:
            bool: æ˜¯å¦ä¸ºç»“ç®—æ—¶é—´
        """
        return (
            timestamp.hour in cls.FUNDING_INTERVALS
            and timestamp.minute == 0
            and timestamp.second == 0
        )
```

#### 5.3.3 ä¿¡å·æ¡¥å®Œæ•´å®ç° (algvex/bridge/)

**æ–‡ä»¶æ¸…å•ä¸ä¾èµ–å…³ç³»**:

```
algvex/bridge/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ converter.py         # SignalConverter (ç‹¬ç«‹æ¨¡å—)
â”œâ”€â”€ redis_channel.py     # RedisSignalChannel (ä¾èµ–: redis)
â””â”€â”€ mqtt_channel.py      # MQTTSignalChannel (ä¾èµ–: hummingbot.remote_iface.mqtt)
```

**converter.py å®Œæ•´å®ç°**:

```python
"""
Qlib ä¿¡å·åˆ° Hummingbot è®¢å•è½¬æ¢å™¨
"""
from dataclasses import dataclass, field
from typing import List, Dict, Optional
from enum import Enum
from decimal import Decimal
import pandas as pd


class OrderSide(str, Enum):
    """è®¢å•æ–¹å‘"""
    BUY = "BUY"
    SELL = "SELL"


class OrderType(str, Enum):
    """è®¢å•ç±»å‹"""
    MARKET = "MARKET"
    LIMIT = "LIMIT"
    STOP_MARKET = "STOP_MARKET"
    TAKE_PROFIT_MARKET = "TAKE_PROFIT_MARKET"


@dataclass
class TradingSignal:
    """
    äº¤æ˜“ä¿¡å·æ•°æ®ç±»

    Attributes:
        symbol: äº¤æ˜“å¯¹ (å¦‚ "BTC-USDT")
        side: è®¢å•æ–¹å‘ (BUY/SELL)
        amount: äº¤æ˜“æ•°é‡
        score: æ¨¡å‹é¢„æµ‹åˆ†æ•° (ç”¨äºæ’åºå’Œåˆ†é…ä»“ä½)
        price: é™ä»·å•ä»·æ ¼ (å¸‚ä»·å•ä¸º None)
        order_type: è®¢å•ç±»å‹
        leverage: æ æ†å€æ•°
        stop_loss: æ­¢æŸä»·æ ¼
        take_profit: æ­¢ç›ˆä»·æ ¼
    """
    symbol: str
    side: OrderSide
    amount: Decimal
    score: float = 0.0
    price: Optional[Decimal] = None
    order_type: OrderType = OrderType.MARKET
    leverage: int = 10
    stop_loss: Optional[Decimal] = None
    take_profit: Optional[Decimal] = None

    def to_dict(self) -> Dict:
        """è½¬æ¢ä¸ºå­—å…¸æ ¼å¼"""
        return {
            "symbol": self.symbol,
            "side": self.side.value,
            "amount": str(self.amount),
            "score": self.score,
            "price": str(self.price) if self.price else None,
            "order_type": self.order_type.value,
            "leverage": self.leverage,
            "stop_loss": str(self.stop_loss) if self.stop_loss else None,
            "take_profit": str(self.take_profit) if self.take_profit else None,
        }


class SignalConverter:
    """
    Qlib é¢„æµ‹ä¿¡å·è½¬æ¢å™¨

    å°† Qlib æ¨¡å‹çš„é¢„æµ‹ç»“æœè½¬æ¢ä¸ºå¯æ‰§è¡Œçš„äº¤æ˜“ä¿¡å·ã€‚

    Attributes:
        long_threshold: åšå¤šé˜ˆå€¼ (score > threshold)
        short_threshold: åšç©ºé˜ˆå€¼ (score < -threshold)
        max_positions: æœ€å¤§æŒä»“æ•°é‡
        position_size_mode: ä»“ä½åˆ†é…æ¨¡å¼
    """

    def __init__(
        self,
        long_threshold: float = 0.0,
        short_threshold: float = 0.0,
        max_positions: int = 10,
        position_size_mode: str = "equal",  # "equal", "score_weighted", "volatility_adjusted"
        total_capital: Decimal = Decimal("10000"),
        default_leverage: int = 10,
    ):
        """
        åˆå§‹åŒ–è½¬æ¢å™¨

        Args:
            long_threshold: åšå¤šé˜ˆå€¼
            short_threshold: åšç©ºé˜ˆå€¼ (ä½¿ç”¨è´Ÿå€¼)
            max_positions: æœ€å¤§åŒæ—¶æŒä»“æ•°
            position_size_mode: ä»“ä½å¤§å°è®¡ç®—æ¨¡å¼
            total_capital: æ€»èµ„é‡‘
            default_leverage: é»˜è®¤æ æ†
        """
        self.long_threshold = long_threshold
        self.short_threshold = short_threshold
        self.max_positions = max_positions
        self.position_size_mode = position_size_mode
        self.total_capital = total_capital
        self.default_leverage = default_leverage

    def convert(
        self,
        predictions: pd.DataFrame,
        current_prices: Dict[str, Decimal] = None,
    ) -> List[TradingSignal]:
        """
        è½¬æ¢ Qlib é¢„æµ‹ç»“æœä¸ºäº¤æ˜“ä¿¡å·

        Args:
            predictions: Qlib é¢„æµ‹ DataFrame
                æ ¼å¼: MultiIndex (datetime, instrument) -> score
                æˆ– columns: ["instrument", "score"]
            current_prices: å½“å‰ä»·æ ¼å­—å…¸ {symbol: price}

        Returns:
            List[TradingSignal]: äº¤æ˜“ä¿¡å·åˆ—è¡¨

        Example:
            >>> converter = SignalConverter(long_threshold=0.02)
            >>> predictions = pd.DataFrame({
            ...     "instrument": ["BTC-USDT", "ETH-USDT"],
            ...     "score": [0.05, -0.03]
            ... })
            >>> signals = converter.convert(predictions)
            >>> len(signals)
            2
        """
        signals = []
        current_prices = current_prices or {}

        # æ ‡å‡†åŒ–è¾“å…¥æ ¼å¼
        if isinstance(predictions.index, pd.MultiIndex):
            df = predictions.reset_index()
            df.columns = ["datetime", "instrument", "score"]
        else:
            df = predictions.copy()

        # ç­›é€‰ä¿¡å·
        long_candidates = df[df["score"] > self.long_threshold].nlargest(
            self.max_positions, "score"
        )
        short_candidates = df[df["score"] < -abs(self.short_threshold)].nsmallest(
            self.max_positions, "score"
        )

        # è®¡ç®—ä»“ä½å¤§å°
        total_signals = len(long_candidates) + len(short_candidates)
        if total_signals == 0:
            return signals

        position_value = self.total_capital / Decimal(min(total_signals, self.max_positions))

        # ç”Ÿæˆå¤šå¤´ä¿¡å·
        for _, row in long_candidates.iterrows():
            symbol = row["instrument"]
            score = row["score"]
            price = current_prices.get(symbol, Decimal("1"))

            amount = self._calculate_amount(position_value, price, score)

            signals.append(TradingSignal(
                symbol=symbol,
                side=OrderSide.BUY,
                amount=amount,
                score=score,
                leverage=self.default_leverage,
            ))

        # ç”Ÿæˆç©ºå¤´ä¿¡å·
        for _, row in short_candidates.iterrows():
            symbol = row["instrument"]
            score = row["score"]
            price = current_prices.get(symbol, Decimal("1"))

            amount = self._calculate_amount(position_value, price, abs(score))

            signals.append(TradingSignal(
                symbol=symbol,
                side=OrderSide.SELL,
                amount=amount,
                score=score,
                leverage=self.default_leverage,
            ))

        return signals

    def _calculate_amount(
        self,
        position_value: Decimal,
        price: Decimal,
        score: float,
    ) -> Decimal:
        """
        è®¡ç®—äº¤æ˜“æ•°é‡

        Args:
            position_value: åˆ†é…çš„ä»“ä½ä»·å€¼
            price: å½“å‰ä»·æ ¼
            score: é¢„æµ‹åˆ†æ•°

        Returns:
            Decimal: äº¤æ˜“æ•°é‡
        """
        if self.position_size_mode == "equal":
            return position_value / price
        elif self.position_size_mode == "score_weighted":
            weight = Decimal(str(min(abs(score) * 10, 2.0)))  # æœ€å¤§ 2 å€
            return (position_value * weight) / price
        else:
            return position_value / price
```

**redis_channel.py å®Œæ•´å®ç°**:

```python
"""
Redis ä¿¡å·é€šé“

ç”¨äº Qlib å’Œ Hummingbot ä¹‹é—´çš„å®æ—¶ä¿¡å·ä¼ é€’
"""
import json
from typing import List, Optional, Callable
from dataclasses import asdict
import redis

from .converter import TradingSignal


class RedisSignalChannel:
    """
    Redis ä¿¡å·é€šé“

    ä½¿ç”¨ Redis Pub/Sub å®ç° Qlib ä¿¡å·åˆ° Hummingbot çš„å®æ—¶ä¼ é€’ã€‚

    Channels:
        - algvex:signals: äº¤æ˜“ä¿¡å·å‘å¸ƒé€šé“
        - algvex:status: ç³»ç»ŸçŠ¶æ€é€šé“
        - algvex:commands: æ§åˆ¶å‘½ä»¤é€šé“

    Attributes:
        SIGNAL_CHANNEL: ä¿¡å·å‘å¸ƒé€šé“å
        STATUS_CHANNEL: çŠ¶æ€é€šé“å
        COMMAND_CHANNEL: å‘½ä»¤é€šé“å
    """

    SIGNAL_CHANNEL = "algvex:signals"
    STATUS_CHANNEL = "algvex:status"
    COMMAND_CHANNEL = "algvex:commands"

    def __init__(
        self,
        host: str = "localhost",
        port: int = 6379,
        db: int = 0,
        password: str = None,
    ):
        """
        åˆå§‹åŒ– Redis è¿æ¥

        Args:
            host: Redis ä¸»æœºåœ°å€
            port: Redis ç«¯å£
            db: Redis æ•°æ®åº“ç¼–å·
            password: Redis å¯†ç  (å¯é€‰)
        """
        self.redis = redis.Redis(
            host=host,
            port=port,
            db=db,
            password=password,
            decode_responses=True,
        )
        self.pubsub = None

    def publish_signals(self, signals: List[TradingSignal]) -> int:
        """
        å‘å¸ƒäº¤æ˜“ä¿¡å·

        Args:
            signals: äº¤æ˜“ä¿¡å·åˆ—è¡¨

        Returns:
            int: æ¥æ”¶åˆ°æ¶ˆæ¯çš„è®¢é˜…è€…æ•°é‡
        """
        message = {
            "type": "signals",
            "data": [s.to_dict() for s in signals],
        }
        return self.redis.publish(self.SIGNAL_CHANNEL, json.dumps(message))

    def publish_status(self, status: dict) -> int:
        """
        å‘å¸ƒç³»ç»ŸçŠ¶æ€

        Args:
            status: çŠ¶æ€ä¿¡æ¯å­—å…¸

        Returns:
            int: æ¥æ”¶åˆ°æ¶ˆæ¯çš„è®¢é˜…è€…æ•°é‡
        """
        message = {
            "type": "status",
            "data": status,
        }
        return self.redis.publish(self.STATUS_CHANNEL, json.dumps(message))

    def subscribe(
        self,
        on_signal: Callable[[List[dict]], None] = None,
        on_status: Callable[[dict], None] = None,
        on_command: Callable[[dict], None] = None,
    ) -> None:
        """
        è®¢é˜…æ¶ˆæ¯é€šé“

        Args:
            on_signal: ä¿¡å·å›è°ƒå‡½æ•°
            on_status: çŠ¶æ€å›è°ƒå‡½æ•°
            on_command: å‘½ä»¤å›è°ƒå‡½æ•°
        """
        self.pubsub = self.redis.pubsub()

        channels = []
        if on_signal:
            channels.append(self.SIGNAL_CHANNEL)
        if on_status:
            channels.append(self.STATUS_CHANNEL)
        if on_command:
            channels.append(self.COMMAND_CHANNEL)

        self.pubsub.subscribe(*channels)

        for message in self.pubsub.listen():
            if message["type"] != "message":
                continue

            data = json.loads(message["data"])
            channel = message["channel"]

            if channel == self.SIGNAL_CHANNEL and on_signal:
                on_signal(data["data"])
            elif channel == self.STATUS_CHANNEL and on_status:
                on_status(data["data"])
            elif channel == self.COMMAND_CHANNEL and on_command:
                on_command(data["data"])

    def close(self) -> None:
        """å…³é—­è¿æ¥"""
        if self.pubsub:
            self.pubsub.close()
        self.redis.close()
```

#### 5.3.4 æ‰§è¡Œå±‚å®Œæ•´å®ç° (algvex/execution/)

**æ–‡ä»¶æ¸…å•**:

```
algvex/execution/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ manager.py           # ExecutorManager (ä¾èµ–: hummingbot.strategy_v2.executors)
â””â”€â”€ router.py            # OrderRouter (ç‹¬ç«‹æ¨¡å—)
```

**manager.py æ ¸å¿ƒæ¥å£**:

```python
"""
æ‰§è¡Œå™¨ç®¡ç†å™¨

é›†æˆ Hummingbot çš„ 7 ä¸ªæ‰§è¡Œå™¨
"""
from typing import Dict, Type, Optional
from enum import Enum

# Hummingbot æ‰§è¡Œå™¨å¯¼å…¥
from hummingbot.strategy_v2.executors.order_executor.order_executor import OrderExecutor
from hummingbot.strategy_v2.executors.position_executor.position_executor import PositionExecutor
from hummingbot.strategy_v2.executors.dca_executor.dca_executor import DCAExecutor
from hummingbot.strategy_v2.executors.twap_executor.twap_executor import TWAPExecutor
from hummingbot.strategy_v2.executors.grid_executor.grid_executor import GridExecutor
from hummingbot.strategy_v2.executors.arbitrage_executor.arbitrage_executor import ArbitrageExecutor
from hummingbot.strategy_v2.executors.xemm_executor.xemm_executor import XEMMExecutor


class ExecutorType(str, Enum):
    """æ‰§è¡Œå™¨ç±»å‹"""
    ORDER = "order"
    POSITION = "position"
    DCA = "dca"
    TWAP = "twap"
    GRID = "grid"
    ARBITRAGE = "arbitrage"
    XEMM = "xemm"


class ExecutorManager:
    """
    æ‰§è¡Œå™¨ç®¡ç†å™¨

    ç»Ÿä¸€ç®¡ç† Hummingbot çš„ 7 ç§æ‰§è¡Œå™¨ï¼Œæ ¹æ®ä¿¡å·ç±»å‹è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ‰§è¡Œå™¨ã€‚

    Executors:
        - OrderExecutor: å•è®¢å•æ‰§è¡Œ
        - PositionExecutor: ä»“ä½æ‰§è¡Œ (Triple Barrier)
        - DCAExecutor: å®šæŠ•æ‰§è¡Œ
        - TWAPExecutor: æ—¶é—´åŠ æƒå‡ä»·
        - GridExecutor: ç½‘æ ¼æ‰§è¡Œ
        - ArbitrageExecutor: å¥—åˆ©æ‰§è¡Œ
        - XEMMExecutor: è·¨äº¤æ˜“æ‰€åšå¸‚
    """

    EXECUTOR_CLASSES: Dict[ExecutorType, Type] = {
        ExecutorType.ORDER: OrderExecutor,
        ExecutorType.POSITION: PositionExecutor,
        ExecutorType.DCA: DCAExecutor,
        ExecutorType.TWAP: TWAPExecutor,
        ExecutorType.GRID: GridExecutor,
        ExecutorType.ARBITRAGE: ArbitrageExecutor,
        ExecutorType.XEMM: XEMMExecutor,
    }

    def __init__(self, connector, default_executor: ExecutorType = ExecutorType.POSITION):
        """
        åˆå§‹åŒ–ç®¡ç†å™¨

        Args:
            connector: Hummingbot è¿æ¥å™¨å®ä¾‹
            default_executor: é»˜è®¤æ‰§è¡Œå™¨ç±»å‹
        """
        self.connector = connector
        self.default_executor = default_executor
        self._executors: Dict[str, object] = {}

    def get_executor(self, executor_type: ExecutorType = None):
        """
        è·å–æ‰§è¡Œå™¨å®ä¾‹

        Args:
            executor_type: æ‰§è¡Œå™¨ç±»å‹

        Returns:
            æ‰§è¡Œå™¨å®ä¾‹
        """
        executor_type = executor_type or self.default_executor

        if executor_type.value not in self._executors:
            executor_class = self.EXECUTOR_CLASSES[executor_type]
            self._executors[executor_type.value] = executor_class(
                strategy=self,
                connector=self.connector,
            )

        return self._executors[executor_type.value]
```

#### 5.3.5 é£æ§å±‚å®Œæ•´å®ç° (algvex/risk/)

**æ–‡ä»¶æ¸…å•**:

```
algvex/risk/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ kill_switch.py       # KillSwitch (ç‹¬ç«‹æ¨¡å—)
â”œâ”€â”€ position_limit.py    # PositionLimitChecker (ç‹¬ç«‹æ¨¡å—)
â””â”€â”€ liquidation.py       # LiquidationMonitor (ä¾èµ–: algvex.backtest.exchange)
```

**kill_switch.py å®Œæ•´å®ç°**:

```python
"""
ç´§æ€¥åœæ­¢å¼€å…³

å½“æ»¡è¶³é¢„è®¾æ¡ä»¶æ—¶ç«‹å³åœæ­¢æ‰€æœ‰äº¤æ˜“æ´»åŠ¨
"""
from typing import Callable, Optional
from decimal import Decimal
from datetime import datetime, timedelta
from enum import Enum
import logging

logger = logging.getLogger(__name__)


class KillSwitchReason(str, Enum):
    """è§¦å‘åŸå› """
    MAX_LOSS = "max_loss"
    MAX_DRAWDOWN = "max_drawdown"
    POSITION_LIMIT = "position_limit"
    API_ERROR = "api_error"
    MANUAL = "manual"
    TIME_LIMIT = "time_limit"


class KillSwitch:
    """
    ç´§æ€¥åœæ­¢å¼€å…³

    ç›‘æ§ä»¥ä¸‹æ¡ä»¶å¹¶åœ¨è§¦å‘æ—¶åœæ­¢äº¤æ˜“:
    - æœ€å¤§äºæŸé‡‘é¢/æ¯”ä¾‹
    - æœ€å¤§å›æ’¤
    - æŒä»“è¶…é™
    - API è¿ç»­é”™è¯¯
    - äº¤æ˜“æ—¶é—´é™åˆ¶

    Attributes:
        is_triggered: æ˜¯å¦å·²è§¦å‘
        trigger_reason: è§¦å‘åŸå› 
        trigger_time: è§¦å‘æ—¶é—´
    """

    def __init__(
        self,
        max_loss_pct: float = 0.1,
        max_loss_amount: Decimal = None,
        max_drawdown_pct: float = 0.15,
        max_position_value: Decimal = None,
        max_api_errors: int = 10,
        trading_hours: tuple = None,
        on_trigger: Callable[["KillSwitch", KillSwitchReason], None] = None,
    ):
        """
        åˆå§‹åŒ– Kill Switch

        Args:
            max_loss_pct: æœ€å¤§äºæŸæ¯”ä¾‹ (0.1 = 10%)
            max_loss_amount: æœ€å¤§äºæŸé‡‘é¢
            max_drawdown_pct: æœ€å¤§å›æ’¤æ¯”ä¾‹
            max_position_value: æœ€å¤§æŒä»“ä»·å€¼
            max_api_errors: æœ€å¤§è¿ç»­ API é”™è¯¯æ¬¡æ•°
            trading_hours: å…è®¸äº¤æ˜“æ—¶é—´ (start_hour, end_hour)
            on_trigger: è§¦å‘å›è°ƒå‡½æ•°
        """
        self.max_loss_pct = Decimal(str(max_loss_pct))
        self.max_loss_amount = max_loss_amount
        self.max_drawdown_pct = Decimal(str(max_drawdown_pct))
        self.max_position_value = max_position_value
        self.max_api_errors = max_api_errors
        self.trading_hours = trading_hours
        self.on_trigger = on_trigger

        # çŠ¶æ€
        self.is_triggered = False
        self.trigger_reason: Optional[KillSwitchReason] = None
        self.trigger_time: Optional[datetime] = None

        # è¿½è¸ªæ•°æ®
        self._initial_capital: Optional[Decimal] = None
        self._peak_value: Optional[Decimal] = None
        self._api_error_count = 0

    def initialize(self, initial_capital: Decimal) -> None:
        """
        åˆå§‹åŒ–èµ„é‡‘è¿½è¸ª

        Args:
            initial_capital: åˆå§‹èµ„é‡‘
        """
        self._initial_capital = initial_capital
        self._peak_value = initial_capital

    def check(
        self,
        current_value: Decimal,
        position_value: Decimal = Decimal(0),
        has_api_error: bool = False,
    ) -> bool:
        """
        æ£€æŸ¥æ˜¯å¦åº”è§¦å‘ Kill Switch

        Args:
            current_value: å½“å‰è´¦æˆ·ä»·å€¼
            position_value: å½“å‰æŒä»“ä»·å€¼
            has_api_error: æ˜¯å¦å‘ç”Ÿ API é”™è¯¯

        Returns:
            bool: æ˜¯å¦è§¦å‘
        """
        if self.is_triggered:
            return True

        # æ›´æ–°å³°å€¼
        if current_value > self._peak_value:
            self._peak_value = current_value

        # æ£€æŸ¥æœ€å¤§äºæŸ
        if self._initial_capital:
            loss_pct = (self._initial_capital - current_value) / self._initial_capital
            if loss_pct > self.max_loss_pct:
                return self._trigger(KillSwitchReason.MAX_LOSS)

            if self.max_loss_amount and (self._initial_capital - current_value) > self.max_loss_amount:
                return self._trigger(KillSwitchReason.MAX_LOSS)

        # æ£€æŸ¥æœ€å¤§å›æ’¤
        if self._peak_value:
            drawdown = (self._peak_value - current_value) / self._peak_value
            if drawdown > self.max_drawdown_pct:
                return self._trigger(KillSwitchReason.MAX_DRAWDOWN)

        # æ£€æŸ¥æŒä»“é™åˆ¶
        if self.max_position_value and position_value > self.max_position_value:
            return self._trigger(KillSwitchReason.POSITION_LIMIT)

        # æ£€æŸ¥ API é”™è¯¯
        if has_api_error:
            self._api_error_count += 1
            if self._api_error_count >= self.max_api_errors:
                return self._trigger(KillSwitchReason.API_ERROR)
        else:
            self._api_error_count = 0

        # æ£€æŸ¥äº¤æ˜“æ—¶é—´
        if self.trading_hours:
            current_hour = datetime.utcnow().hour
            start, end = self.trading_hours
            if not (start <= current_hour < end):
                return self._trigger(KillSwitchReason.TIME_LIMIT)

        return False

    def _trigger(self, reason: KillSwitchReason) -> bool:
        """è§¦å‘ Kill Switch"""
        self.is_triggered = True
        self.trigger_reason = reason
        self.trigger_time = datetime.utcnow()

        logger.critical(f"Kill Switch è§¦å‘! åŸå› : {reason.value}")

        if self.on_trigger:
            self.on_trigger(self, reason)

        return True

    def reset(self) -> None:
        """é‡ç½® Kill Switch"""
        self.is_triggered = False
        self.trigger_reason = None
        self.trigger_time = None
        self._api_error_count = 0
        logger.info("Kill Switch å·²é‡ç½®")
```

---

## å…­ã€å®æ–½é˜¶æ®µ

### é˜¶æ®µ 1: ç¯å¢ƒæ­å»º

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 1.1 | åˆ›å»ºé¡¹ç›®ç»“æ„ | æ—  | algvex/ ç›®å½•ç»“æ„ | ç›®å½•ç»“æ„å®Œæ•´ |
| 1.2 | å®‰è£… Qlib | libs/qlib | pip å¯ç”¨ | `import qlib` æˆåŠŸ |
| 1.3 | å®‰è£… Hummingbot | libs/hummingbot | pip å¯ç”¨ | `import hummingbot` æˆåŠŸ |
| 1.4 | ç¼–å†™ requirements.txt | æ—  | requirements.txt | æ‰€æœ‰ä¾èµ–å¯å®‰è£… |
| 1.5 | ç¼–å†™ install.sh | æ—  | scripts/install.sh | ä¸€é”®å®‰è£…æˆåŠŸ |

**install.sh è„šæœ¬**:

```bash
#!/bin/bash
set -euo pipefail

echo "=== AlgVex å®‰è£…è„šæœ¬ ==="

# 1. æ£€æŸ¥ Python ç‰ˆæœ¬
python_version=$(python3 --version 2>&1 | awk '{print $2}')
echo "Python ç‰ˆæœ¬: $python_version"

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
if [ ! -d "venv" ]; then
    python3 -m venv venv
    echo "è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º"
fi
source venv/bin/activate

# 3. å‡çº§ pip
pip install --upgrade pip

# 4. å®‰è£… Qlib
echo "å®‰è£… Qlib..."
pip install -e libs/qlib

# 5. å®‰è£… Hummingbot
echo "å®‰è£… Hummingbot..."
pip install -e libs/hummingbot

# 6. å®‰è£…å…¶ä»–ä¾èµ–
echo "å®‰è£…å…¶ä»–ä¾èµ–..."
pip install -r requirements.txt

# 7. å®‰è£… algvex
pip install -e .

echo "=== å®‰è£…å®Œæˆ ==="
```

### é˜¶æ®µ 2: æ•°æ®å±‚å¼€å‘

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 2.1 | å®ç° CryptoCalendarProvider | Qlib CalendarProvider | calendar.py | ç”Ÿæˆ 24/7 æ—¶é—´æˆ³ |
| 2.2 | å®ç° CryptoInstrumentProvider | Qlib InstrumentProvider | instrument.py | è¿”å›åŠ å¯†è´§å¸åˆ—è¡¨ |
| 2.3 | å®ç° BinancePerpetualCollector | Qlib CryptoCollector | collector.py | æ”¶é›† 1h æ•°æ®æˆåŠŸ |
| 2.4 | å®ç°æ•°æ®è½¬æ¢å™¨ | Hummingbot Candles | converter.py | è½¬æ¢æ ¼å¼æ­£ç¡® |
| 2.5 | å®ç° CryptoDataHandler | Qlib Alpha158 | handler.py | å› å­è®¡ç®—æ­£ç¡® |
| 2.6 | ç¼–å†™æ•°æ®ä¸‹è½½è„šæœ¬ | æ—  | download_data.py | å¯ä¸‹è½½å†å²æ•°æ® |

**æµ‹è¯•ç”¨ä¾‹**:

```python
def test_calendar_provider():
    """æµ‹è¯•æ—¥å†æä¾›è€…"""
    provider = CryptoCalendarProvider()
    cal = provider.calendar("2024-01-01", "2024-01-02", freq="1h")
    assert len(cal) == 24  # 24 å°æ—¶

def test_data_collector():
    """æµ‹è¯•æ•°æ®æ”¶é›†å™¨"""
    collector = BinancePerpetualCollector(["BTC-USDT"], interval="1h")
    df = collector.collect("2024-01-01", "2024-01-07")
    assert len(df) > 0
    assert "open" in df.columns
    assert "close" in df.columns
```

### é˜¶æ®µ 3: å› å­å±‚å¼€å‘

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 3.1 | å®ç° CryptoAlpha158 | Qlib Alpha158 | alpha158.py | 158 å› å­è®¡ç®—æ­£ç¡® |
| 3.2 | å®ç° CryptoAlpha360 | Qlib Alpha360 | alpha360.py | 360 å› å­è®¡ç®—æ­£ç¡® |
| 3.3 | éªŒè¯ 52 ä¸ªæ“ä½œç¬¦ | Qlib ops | æµ‹è¯•æŠ¥å‘Š | æ‰€æœ‰æ“ä½œç¬¦å¯ç”¨ |
| 3.4 | å®ç°è‡ªå®šä¹‰å› å­ | æ—  | custom.py | èµ„é‡‘è´¹ç‡å› å­ç­‰ |

**CryptoAlpha158 çª—å£é€‚é…**:

> **è®¾è®¡åŸåˆ™**: åŠ å¯†è´§å¸å¸‚åœºèŠ‚å¥æ¯”ä¼ ç»Ÿè‚¡å¸‚æ›´å¿«ï¼Œå› æ­¤é‡‡ç”¨**æ—¶é—´å‹ç¼©**ç­–ç•¥ã€‚
> åŸå§‹ Alpha158 ä½¿ç”¨ 5/10/20/30/60 å¤©çª—å£ï¼Œè¿™é‡Œå‹ç¼©ä¸º 1/2/5/7/14 å¤©å¯¹åº”çš„å°æ—¶æ•°ã€‚
> å¦‚éœ€ä¿æŒåŸå§‹ç­‰ä»·æ€§ï¼Œå¯ä½¿ç”¨ `windows = [w * 24 for w in [5, 10, 20, 30, 60]]`ã€‚

| åŸå§‹çª—å£ (æ—¥çº¿) | é€‚é…çª—å£ (å°æ—¶çº¿) | ç­‰ä»·å¤©æ•° | å‹ç¼©æ¯” |
|----------------|-------------------|----------|--------|
| 5 days | 24 hours | 1 å¤© | 5:1 |
| 10 days | 48 hours | 2 å¤© | 5:1 |
| 20 days | 120 hours | 5 å¤© | 4:1 |
| 30 days | 168 hours | 7 å¤© | 4.3:1 |
| 60 days | 336 hours | 14 å¤© | 4.3:1 |

```python
# algvex/factors/alpha158.py é…ç½®é€‰é¡¹
WINDOW_MODE = "compressed"  # "compressed" æˆ– "equivalent"

COMPRESSED_WINDOWS = [24, 48, 120, 168, 336]  # å‹ç¼©æ¨¡å¼ (é»˜è®¤)
EQUIVALENT_WINDOWS = [120, 240, 480, 720, 1440]  # ç­‰ä»·æ¨¡å¼ (5*24, 10*24, ...)
```

### é˜¶æ®µ 4: å›æµ‹å±‚å¼€å‘

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 4.1 | å®ç° CryptoExchange | Qlib Exchange | exchange.py | æ”¯æŒæ æ†/åšç©º |
| 4.2 | å®ç° PerpetualPosition | Qlib Position | position.py | ä»“ä½è®¡ç®—æ­£ç¡® |
| 4.3 | å®ç°èµ„é‡‘è´¹ç‡è®¡ç®— | æ—  | funding.py | è´¹ç‡è®¡ç®—æ­£ç¡® |
| 4.4 | å®ç° CryptoExecutor | Qlib Executor | executor.py | æ‰§è¡Œé€»è¾‘æ­£ç¡® |
| 4.5 | é›†æˆ NestedExecutor | Qlib NestedExecutor | æµ‹è¯• | å¤šå±‚æ‰§è¡Œæ­£ç¡® |

**æ°¸ç»­åˆçº¦è§„åˆ™**:

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| æ æ† | 10x | 1-125 å¯é…ç½® |
| ä¿è¯é‡‘æ¨¡å¼ | å…¨ä»“ | cross/isolated |
| æŒä»“æ¨¡å¼ | å•å‘ | one_way/hedge |
| èµ„é‡‘è´¹ç‡ç»“ç®— | 8å°æ—¶ | æ¯ 8 å°æ—¶ |
| æ‰‹ç»­è´¹ | 0.02%/0.04% | Maker/Taker |

### é˜¶æ®µ 5: æ¨¡å‹éªŒè¯

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 5.1 | éªŒè¯ä¼ ç»Ÿ ML æ¨¡å‹ (5) | è®­ç»ƒæ•°æ® | æµ‹è¯•æŠ¥å‘Š | IC > 0.02 |
| 5.2 | éªŒè¯ RNN æ¨¡å‹ (12) | è®­ç»ƒæ•°æ® | æµ‹è¯•æŠ¥å‘Š | IC > 0.02 |
| 5.3 | éªŒè¯ Transformer æ¨¡å‹ (4) | è®­ç»ƒæ•°æ® | æµ‹è¯•æŠ¥å‘Š | IC > 0.02 |
| 5.4 | éªŒè¯ CNN æ¨¡å‹ (3) | è®­ç»ƒæ•°æ® | æµ‹è¯•æŠ¥å‘Š | IC > 0.02 |
| 5.5 | éªŒè¯é«˜çº§æ¨¡å‹ (8) | è®­ç»ƒæ•°æ® | æµ‹è¯•æŠ¥å‘Š | IC > 0.02 |
| 5.6 | æ¨¡å‹å¯¹æ¯”æŠ¥å‘Š | æ‰€æœ‰ç»“æœ | æŠ¥å‘Šæ–‡æ¡£ | é€‰å‡ºæœ€ä¼˜æ¨¡å‹ |

**æ¨¡å‹éªŒè¯æµç¨‹**:

```
æ•°æ®å‡†å¤‡ -> è®­ç»ƒé›†/éªŒè¯é›†/æµ‹è¯•é›†åˆ’åˆ† -> æ¨¡å‹è®­ç»ƒ -> é¢„æµ‹ -> è¯„ä¼°æŒ‡æ ‡
                                                              |
                                                              v
                                                    IC, ICIR, å¹´åŒ–æ”¶ç›Š, æœ€å¤§å›æ’¤
```

### é˜¶æ®µ 6: ä¿¡å·æ¡¥å¼€å‘

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 6.1 | å®ç°ä¿¡å·è½¬æ¢å™¨ | Qlib é¢„æµ‹ | converter.py | è½¬æ¢æ­£ç¡® |
| 6.2 | å®ç° Redis é€šé“ | æ—  | redis_channel.py | æ¶ˆæ¯æ”¶å‘æˆåŠŸ |
| 6.3 | å®ç° MQTT é€šé“ | Hummingbot MQTT | mqtt_channel.py | æ¶ˆæ¯æ”¶å‘æˆåŠŸ |
| 6.4 | é›†æˆ Hummingbot æ‰§è¡Œå™¨ | 7 ä¸ªæ‰§è¡Œå™¨ | manager.py | å…¨éƒ¨å¯ç”¨ |

**ä¿¡å·æ ¼å¼**:

```json
{
  "timestamp": "2024-01-01T00:00:00Z",
  "signals": [
    {"symbol": "BTC-USDT", "side": "BUY", "score": 0.85, "amount": 0.1},
    {"symbol": "ETH-USDT", "side": "SELL", "score": -0.72, "amount": 0.5}
  ]
}
```

### é˜¶æ®µ 7: é£æ§å¼€å‘

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 7.1 | å®ç° Kill Switch | Hummingbot KillSwitch | kill_switch.py | è§¦å‘åœæ­¢æ­£ç¡® |
| 7.2 | å®ç°ä»“ä½é™åˆ¶ | æ—  | position_limit.py | é™åˆ¶ç”Ÿæ•ˆ |
| 7.3 | å®ç°å¼ºå¹³ç›‘æ§ | æ—  | liquidation.py | é¢„è­¦æ­£ç¡® |
| 7.4 | é›†æˆ Triple Barrier | Hummingbot | æµ‹è¯• | æ­¢ç›ˆæ­¢æŸæ­£ç¡® |

### é˜¶æ®µ 8: å·¥ä½œæµå¼€å‘

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 8.1 | å®ç°è®­ç»ƒç®¡ç†å™¨ | Qlib Trainer | trainer.py | è®­ç»ƒæµç¨‹æ­£ç¡® |
| 8.2 | å®ç°æ»šåŠ¨è®­ç»ƒ | Qlib RollingGen | rolling.py | æ»šåŠ¨æ›´æ–°æ­£ç¡® |
| 8.3 | å®ç°åœ¨çº¿æœåŠ¡ | Qlib OnlineManager | online.py | å¢é‡é¢„æµ‹æ­£ç¡® |
| 8.4 | é›†æˆ MLflow | æ—  | é…ç½® | å®éªŒè·Ÿè¸ªå¯ç”¨ |

### é˜¶æ®µ 9: ç”¨æˆ·æ¥å£å¼€å‘

**ä»»åŠ¡æ¸…å•**:

| ç¼–å· | ä»»åŠ¡ | è¾“å…¥ | è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|------|----------|
| 9.1 | å®ç° CLI | æ—  | cli/main.py | å‘½ä»¤å¯ç”¨ |
| 9.2 | å®ç° Dashboard | Streamlit | dashboard/app.py | ç•Œé¢å¯ç”¨ |
| 9.3 | ç¼–å†™å¯åŠ¨è„šæœ¬ | æ—  | start.sh | ä¸€é”®å¯åŠ¨ |
| 9.4 | ç¼–å†™åœæ­¢è„šæœ¬ | æ—  | stop.sh | ä¸€é”®åœæ­¢ |

**CLI å‘½ä»¤**:

```bash
# æ•°æ®å‘½ä»¤
algvex data download --symbols BTC-USDT,ETH-USDT --start 2024-01-01 --end 2024-12-01

# è®­ç»ƒå‘½ä»¤
algvex train --model LGBModel --config config/strategies/default.yaml

# å›æµ‹å‘½ä»¤
algvex backtest --model ./models/lgb_model.pkl --start 2024-06-01 --end 2024-12-01

# äº¤æ˜“å‘½ä»¤
algvex trade --mode paper --exchange binance_perpetual
algvex trade --mode live --exchange binance_perpetual
```

---

## ä¸ƒã€æœ¬åœ°æµ‹è¯•æ–¹æ¡ˆ

### 7.1 æµ‹è¯•ç¯å¢ƒ

| é¡¹ç›® | è¦æ±‚ |
|------|------|
| æ“ä½œç³»ç»Ÿ | Ubuntu 22.04 / macOS / Windows WSL2 |
| Python | 3.10 |
| å†…å­˜ | >= 16GB |
| ç£ç›˜ | >= 50GB |

### 7.2 æµ‹è¯•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æœ¬åœ°æµ‹è¯•æµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  1. ç¯å¢ƒéªŒè¯                                                     â”‚
â”‚     â””â”€â”€ python --version                                         â”‚
â”‚     â””â”€â”€ pip list (æ£€æŸ¥ä¾èµ–)                                      â”‚
â”‚                                                                  â”‚
â”‚  2. å•å…ƒæµ‹è¯•                                                     â”‚
â”‚     â””â”€â”€ pytest tests/unit/ -v --cov=algvex                      â”‚
â”‚                                                                  â”‚
â”‚  3. æ•°æ®æµ‹è¯•                                                     â”‚
â”‚     â””â”€â”€ python scripts/download_data.py --test                  â”‚
â”‚     â””â”€â”€ éªŒè¯æ•°æ®æ ¼å¼å’Œå®Œæ•´æ€§                                     â”‚
â”‚                                                                  â”‚
â”‚  4. å› å­æµ‹è¯•                                                     â”‚
â”‚     â””â”€â”€ è®¡ç®— Alpha158 å› å­                                       â”‚
â”‚     â””â”€â”€ éªŒè¯å› å­å€¼èŒƒå›´                                           â”‚
â”‚                                                                  â”‚
â”‚  5. æ¨¡å‹æµ‹è¯•                                                     â”‚
â”‚     â””â”€â”€ ä½¿ç”¨å°æ•°æ®é›†å¿«é€Ÿè®­ç»ƒ                                     â”‚
â”‚     â””â”€â”€ éªŒè¯æ¨¡å‹è¾“å‡ºæ ¼å¼                                         â”‚
â”‚                                                                  â”‚
â”‚  6. å›æµ‹æµ‹è¯•                                                     â”‚
â”‚     â””â”€â”€ è¿è¡ŒçŸ­æœŸå›æµ‹ (7å¤©)                                       â”‚
â”‚     â””â”€â”€ éªŒè¯æ”¶ç›Š/æŒ‡æ ‡è®¡ç®—                                        â”‚
â”‚                                                                  â”‚
â”‚  7. Paper Trading æµ‹è¯•                                           â”‚
â”‚     â””â”€â”€ å¯åŠ¨æ¨¡æ‹Ÿäº¤æ˜“                                             â”‚
â”‚     â””â”€â”€ éªŒè¯è®¢å•æ‰§è¡Œ                                             â”‚
â”‚     â””â”€â”€ è¿è¡Œ 24 å°æ—¶                                             â”‚
â”‚                                                                  â”‚
â”‚  8. é›†æˆæµ‹è¯•                                                     â”‚
â”‚     â””â”€â”€ pytest tests/integration/ -v                            â”‚
â”‚     â””â”€â”€ ç«¯åˆ°ç«¯æµç¨‹éªŒè¯                                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 æµ‹è¯•å‘½ä»¤

```bash
# 1. è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
pytest tests/unit/ -v --cov=algvex --cov-report=html

# 2. è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
pytest tests/unit/test_data.py -v
pytest tests/unit/test_factors.py -v
pytest tests/unit/test_backtest.py -v

# 3. è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/integration/ -v

# 4. è¿è¡Œ Paper Trading æµ‹è¯•
python -m algvex.cli trade --mode paper --exchange binance_perpetual --duration 24h

# 5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
pytest --html=reports/test_report.html --self-contained-html
```

### 7.4 æµ‹è¯•æ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹ | é€šè¿‡æ ‡å‡† |
|--------|----------|
| å•å…ƒæµ‹è¯•é€šè¿‡ç‡ | 100% |
| ä»£ç è¦†ç›–ç‡ | > 80% |
| æ•°æ®æ”¶é›† | BTC-USDT 1å°æ—¶æ•°æ®å¯æ”¶é›† |
| å› å­è®¡ç®— | 158 å› å­å…¨éƒ¨è®¡ç®—æˆåŠŸ |
| æ¨¡å‹è®­ç»ƒ | LGBModel è®­ç»ƒæˆåŠŸ |
| å›æµ‹è¿è¡Œ | æ— é”™è¯¯å®Œæˆ |
| Paper Trading | 24å°æ—¶æ— é”™è¯¯ |
| é›†æˆæµ‹è¯• | å…¨éƒ¨é€šè¿‡ |

---

## å…«ã€æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ

### 8.1 æœåŠ¡å™¨è¦æ±‚

| é¡¹ç›® | æœ€ä½é…ç½® | æ¨èé…ç½® |
|------|----------|----------|
| æ“ä½œç³»ç»Ÿ | Ubuntu 22.04 LTS | Ubuntu 22.04 LTS |
| CPU | 4 æ ¸ | 8 æ ¸ |
| å†…å­˜ | 16 GB | 32 GB |
| ç£ç›˜ | 100 GB SSD | 500 GB SSD |
| ç½‘ç»œ | 100 Mbps | 1 Gbps |
| Python | 3.10 | 3.10 |

### 8.2 éƒ¨ç½²æ­¥éª¤

#### æ­¥éª¤ 1: ç³»ç»Ÿå‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y git curl wget vim htop

# å®‰è£… Python 3.10
sudo apt install -y python3.10 python3.10-venv python3.10-dev python3-pip

# å®‰è£…æ„å»ºå·¥å…·
sudo apt install -y build-essential libssl-dev libffi-dev

# å®‰è£… Redis (ä¿¡å·æ¡¥)
sudo apt install -y redis-server
sudo systemctl enable redis-server
sudo systemctl start redis-server
```

#### æ­¥éª¤ 2: é¡¹ç›®éƒ¨ç½²

```bash
# åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p /opt/algvex
sudo chown $USER:$USER /opt/algvex
cd /opt/algvex

# å…‹éš†ä»£ç 
git clone --recursive https://github.com/FelixWayne0318/AlgVex.git .

# è¿è¡Œå®‰è£…è„šæœ¬
chmod +x scripts/install.sh
./scripts/install.sh
```

#### æ­¥éª¤ 3: é…ç½®æ–‡ä»¶

```yaml
# /opt/algvex/config/settings.yaml
environment: production

# æ•°æ®é…ç½®
data:
  provider_uri: /opt/algvex/data/qlib_data
  cache_dir: /opt/algvex/cache

# äº¤æ˜“æ‰€é…ç½®
exchange:
  name: binance_perpetual
  leverage: 10
  margin_mode: cross

# Redis é…ç½®
redis:
  host: localhost
  port: 6379
  db: 0

# æ—¥å¿—é…ç½® (ä½¿ç”¨ Qlib/Hummingbot å†…ç½®)
logging:
  level: INFO
  dir: /opt/algvex/logs
```

#### æ­¥éª¤ 4: Systemd æœåŠ¡

```ini
# /etc/systemd/system/algvex.service
[Unit]
Description=AlgVex Trading Service
After=network.target redis-server.service

[Service]
Type=simple
User=algvex
WorkingDirectory=/opt/algvex
ExecStart=/opt/algvex/venv/bin/python -m algvex.cli trade --mode live
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable algvex
sudo systemctl start algvex
```

### 8.3 ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# scripts/deploy.sh
set -euo pipefail

echo "=== AlgVex æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬ ==="

# å˜é‡
DEPLOY_DIR="/opt/algvex"
SERVICE_USER="algvex"

# 1. åˆ›å»ºç”¨æˆ·
if ! id "$SERVICE_USER" &>/dev/null; then
    sudo useradd -r -s /bin/false $SERVICE_USER
    echo "ç”¨æˆ· $SERVICE_USER å·²åˆ›å»º"
fi

# 2. åˆ›å»ºç›®å½•
sudo mkdir -p $DEPLOY_DIR
sudo chown $SERVICE_USER:$SERVICE_USER $DEPLOY_DIR

# 3. å®‰è£…ç³»ç»Ÿä¾èµ–
sudo apt update
sudo apt install -y python3.10 python3.10-venv python3-pip redis-server git

# 4. å…‹éš†ä»£ç 
cd $DEPLOY_DIR
if [ ! -d ".git" ]; then
    sudo -u $SERVICE_USER git clone --recursive https://github.com/FelixWayne0318/AlgVex.git .
fi

# 5. è¿è¡Œå®‰è£…
sudo -u $SERVICE_USER bash scripts/install.sh

# 6. å¤åˆ¶é…ç½®
if [ ! -f "config/settings.yaml" ]; then
    sudo -u $SERVICE_USER cp config/settings.yaml.example config/settings.yaml
    echo "è¯·ç¼–è¾‘ config/settings.yaml é…ç½®äº¤æ˜“æ‰€ API å¯†é’¥"
fi

# 7. è®¾ç½® Systemd æœåŠ¡
sudo cp scripts/algvex.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable algvex

echo "=== éƒ¨ç½²å®Œæˆ ==="
echo "å¯åŠ¨æœåŠ¡: sudo systemctl start algvex"
echo "æŸ¥çœ‹æ—¥å¿—: sudo journalctl -u algvex -f"
```

### 8.4 è¿ç»´å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start algvex

# åœæ­¢æœåŠ¡
sudo systemctl stop algvex

# é‡å¯æœåŠ¡
sudo systemctl restart algvex

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status algvex

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u algvex -f

# æŸ¥çœ‹ Hummingbot æ—¥å¿—
tail -f /opt/algvex/logs/hummingbot.log

# æŸ¥çœ‹ Qlib æ—¥å¿—
tail -f /opt/algvex/logs/qlib.log
```

---

## ä¹ã€éªŒæ”¶æ ‡å‡†

### 9.1 åŠŸèƒ½éªŒæ”¶

| æ¨¡å— | éªŒæ”¶æ ‡å‡† |
|------|----------|
| æ•°æ®å±‚ | æˆåŠŸæ”¶é›† BTC-USDT 1å°æ—¶æ•°æ® >= 1å¹´ |
| å› å­å±‚ | Alpha158 å…¨éƒ¨ 158 å› å­è®¡ç®—æ­£ç¡® |
| æ¨¡å‹å±‚ | 32 ä¸ªæ¨¡å‹å…¨éƒ¨å¯è®­ç»ƒ |
| å›æµ‹å±‚ | å›æµ‹ IC > 0.02, æ— è®¡ç®—é”™è¯¯ |
| ä¿¡å·æ¡¥ | Qlib ä¿¡å·æˆåŠŸä¼ é€’åˆ° Hummingbot |
| æ‰§è¡Œå±‚ | 7 ä¸ªæ‰§è¡Œå™¨å…¨éƒ¨å¯ç”¨ |
| é£æ§å±‚ | Kill Switch æ­£ç¡®è§¦å‘ |
| Paper Trading | 24 å°æ—¶æ— é”™è¯¯è¿è¡Œ |

### 9.2 æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | æ ‡å‡† |
|------|------|
| æ•°æ®æ”¶é›†é€Ÿåº¦ | >= 1000 æ¡/ç§’ |
| å› å­è®¡ç®—é€Ÿåº¦ | 1 å¹´æ•°æ® < 5 åˆ†é’Ÿ |
| æ¨¡å‹æ¨ç†å»¶è¿Ÿ | < 100ms |
| è®¢å•æ‰§è¡Œå»¶è¿Ÿ | < 500ms |
| ç³»ç»Ÿå†…å­˜å ç”¨ | < 8GB |

### 9.3 ç¨³å®šæ€§éªŒæ”¶

| æŒ‡æ ‡ | æ ‡å‡† |
|------|------|
| Paper Trading | è¿ç»­ 7 å¤©æ— é”™è¯¯ |
| æœåŠ¡å¯ç”¨æ€§ | > 99.9% |
| è‡ªåŠ¨é‡å¯ | å¼‚å¸¸å 30 ç§’å†…æ¢å¤ |

---

## åã€äº¤ä»˜ç‰©æ¸…å•

| äº¤ä»˜ç‰© | è¯´æ˜ | çŠ¶æ€ |
|--------|------|------|
| æºä»£ç  | algvex/ å®Œæ•´ä»£ç  | å¾…å¼€å‘ |
| é…ç½®æ–‡ä»¶ | config/ ç›®å½• | å¾…å¼€å‘ |
| å®‰è£…è„šæœ¬ | scripts/install.sh | å¾…å¼€å‘ |
| éƒ¨ç½²è„šæœ¬ | scripts/deploy.sh | å¾…å¼€å‘ |
| å¯åŠ¨/åœæ­¢è„šæœ¬ | scripts/start.sh, stop.sh | å¾…å¼€å‘ |
| Systemd æœåŠ¡æ–‡ä»¶ | scripts/algvex.service | å¾…å¼€å‘ |
| å•å…ƒæµ‹è¯• | tests/unit/ | å¾…å¼€å‘ |
| é›†æˆæµ‹è¯• | tests/integration/ | å¾…å¼€å‘ |
| æœ¬æ–‡æ¡£ | EXECUTION-PLAN.md | âœ… å®Œæˆ |

---

## é™„å½• A: å‚è€ƒèµ„æº

### Qlib å®˜æ–¹èµ„æº

| èµ„æº | é“¾æ¥ |
|------|------|
| GitHub | https://github.com/microsoft/qlib |
| æ–‡æ¡£ | https://qlib.readthedocs.io/ |
| è¡¨è¾¾å¼æ“ä½œç¬¦ | https://github.com/microsoft/qlib/blob/main/qlib/data/ops.py |
| ä»»åŠ¡ç®¡ç† | https://qlib.readthedocs.io/en/latest/advanced/task_management.html |
| åœ¨çº¿æœåŠ¡ | https://qlib.readthedocs.io/en/latest/component/online.html |
| åµŒå¥—æ‰§è¡Œ | https://qlib.readthedocs.io/en/latest/component/highfreq.html |

### Hummingbot å®˜æ–¹èµ„æº

| èµ„æº | é“¾æ¥ |
|------|------|
| GitHub | https://github.com/hummingbot/hummingbot |
| æ–‡æ¡£ | https://hummingbot.org |
| Dashboard | https://github.com/hummingbot/dashboard |
| è¿æ¥å™¨ | https://hummingbot.org/exchanges/ |
| Strategy V2 | https://hummingbot.org/v2-strategies/ |
| API å‚è€ƒ | https://hummingbot.org/hummingbot-api/ |

### æœ¬åœ°æºç è·¯å¾„

```
libs/
â”œâ”€â”€ qlib/                              # Qlib v0.9.7
â”‚   â”œâ”€â”€ qlib/
â”‚   â”‚   â”œâ”€â”€ contrib/
â”‚   â”‚   â”‚   â”œâ”€â”€ model/                 # 32 ä¸ªæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ data/                  # Alpha158, Alpha360
â”‚   â”‚   â”‚   â”œâ”€â”€ strategy/              # ç­–ç•¥
â”‚   â”‚   â”‚   â”œâ”€â”€ ops/                   # é«˜é¢‘æ“ä½œç¬¦
â”‚   â”‚   â”‚   â””â”€â”€ tuner/                 # è¶…å‚æ•°è°ƒä¼˜
â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â””â”€â”€ ops.py                 # 52 ä¸ªæ“ä½œç¬¦
â”‚   â”‚   â”œâ”€â”€ backtest/                  # å›æµ‹æ¡†æ¶
â”‚   â”‚   â”œâ”€â”€ workflow/                  # å·¥ä½œæµ
â”‚   â”‚   â””â”€â”€ model/
â”‚   â”‚       â”œâ”€â”€ riskmodel/             # é£é™©æ¨¡å‹
â”‚   â”‚       â””â”€â”€ ens/                   # é›†æˆå­¦ä¹ 
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ data_collector/crypto/     # å·²æœ‰ Crypto æ”¶é›†å™¨
â”‚
â””â”€â”€ hummingbot/                        # Hummingbot v2.11.0
    â””â”€â”€ hummingbot/
        â”œâ”€â”€ connector/
        â”‚   â”œâ”€â”€ derivative/            # 11 æ°¸ç»­è¿æ¥å™¨
        â”‚   â””â”€â”€ exchange/              # 26 ç°è´§è¿æ¥å™¨
        â”œâ”€â”€ strategy/                  # 9 V1 ç­–ç•¥
        â”œâ”€â”€ strategy_v2/
        â”‚   â”œâ”€â”€ executors/             # 7 æ‰§è¡Œå™¨
        â”‚   â”œâ”€â”€ controllers/           # V2 æ§åˆ¶å™¨
        â”‚   â””â”€â”€ backtesting/           # å›æµ‹å¼•æ“
        â”œâ”€â”€ data_feed/
        â”‚   â””â”€â”€ candles_feed/          # 21+ Kçº¿æ•°æ®æº
        â””â”€â”€ remote_iface/
            â””â”€â”€ mqtt.py                # MQTT æ¶ˆæ¯
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 3.0 (åˆå¹¶æŠ€æœ¯æ–¹æ¡ˆ)
**åˆ›å»ºæ—¥æœŸ**: 2025-12-31
**æ›´æ–°æ—¥æœŸ**: 2025-12-31
**æ›´æ–°å†å²**:
- v3.0: åˆå¹¶ TECHNICAL-PROPOSAL.mdï¼Œæ·»åŠ é€‚é…ç­–ç•¥æ ‡è®°ã€æºç è·¯å¾„ã€å‚è€ƒèµ„æºé™„å½•
- v2.1: ä¿®å¤æ¨¡å‹è®¡æ•°é”™è¯¯ (31â†’32), ä¿®æ­£ VWAPExecutor æè¿°, è¡¥å…… Alpha158 çª—å£é€‚é…è¯´æ˜, æ·»åŠ  5.3 èŠ‚è¯¦ç»†å®ç°è§„èŒƒ
- v2.0: é‡å†™æ‰§è¡Œæ–¹æ¡ˆç»“æ„
- v1.0: åˆå§‹ç‰ˆæœ¬
